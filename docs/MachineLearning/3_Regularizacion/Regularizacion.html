
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Regularización - Optimización - Feature Engineering - Pipelines &#8212; Inteligencia Artificial Moderna</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Modelos no paramétricos: K-Nearest Neighbours y Árboles de decisión" href="../5_KNNyArbolesDeDecision/KNN_Arboles.html" />
    <link rel="prev" title="Regresión Lineal Múltiple" href="../2_RegresionLinealMultiple/RegresionLinealMultiple.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logohumai.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Inteligencia Artificial Moderna</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Inteligencia Artificial Moderna
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduccion a la Programación con Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/README.html">
   Introducción a Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/1_TiposDatos/tipos-datos.html">
   Introducción a la programación con Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/1_TiposDatos/ejercicio/ejercicios.html">
   Ejercicios I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/2_Listas_Y_Funciones/listas-funciones.html">
   Listas, Funciones, Errores
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/2_Listas_Y_Funciones/ejercicio/ejercicio.html">
   Ejercicios II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/2_Listas_Y_Funciones/ejercicio/adicionales.html">
   Ejercicios Adicionales II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/3_Modulos_Funciones/modulos-funciones.html">
   Módulos y Algorítmos
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/3_Modulos_Funciones/ejercicio/ejercicio.html">
   Ejercicios III
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/4_Intro_Poo/intro-poo.html">
   Programación orientada a objetos
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/4_Intro_Poo/ejercicio/ejercicio.html">
   Ejercicios POO IV
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/5_Poo_Experimento/poo-experimento.html">
   Aplicación de POO: Experimento de Tiempo de Reacción
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Introduccion/6_Poo_Proyecto/poo-proyecto.html">
   Aplicación de POO: PACMAN
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Automatización
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Automatizacion/README.html">
   Automatización y Minería Web
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Automatizacion/Automatizaci%C3%B3n_I/automatizacion_pygui_bash_os.html">
   Automatización
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Automatizacion/Automatizaci%C3%B3n_2/clase_automatizacion_2_gsheets_cron_mails.html">
   Automatización II: outputs, envío de mail, volcado a GSheets, scheduling
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Automatizacion/Automatizaci%C3%B3n_2/clase_automatizacion_2_ejercicios.html">
   Ejercicios Automatización II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Automatizacion/Expresiones_Regulares/expresiones_regulares.html">
   Expresiones Regulares
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Automatizacion/Otros/gsheets_pytrends.html">
   Práctica: GSheet y PyTrends
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Automatizacion/Otros/organizando_pdfs.html">
   Ejercicio: Organizando PDFs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Automatizacion/Otros/edicion_imagenes.html">
   Edición de Imágenes con Python
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Minería Web
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../Scraping/README.html">
   Minería Web con Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Scraping/1_HTTP_Inicial/web_scraping_http_inicial.html">
   Web Scraping: Extrayendo datos de Internet
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Scraping/1_HTTP_Inicial/ejercicio/spinetta.html">
   Descargar letras de canciones
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Scraping/2_HTTP_Avanzado/scraping_http_avanzado.html">
   Encontrando APIs ocultas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Scraping/2_HTTP_Avanzado/scraping_avanzado_2.html">
   Práctica: Scraping Avanzado 2:
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Scraping/2_HTTP_Avanzado/ejercicio/apis-ocultas.html">
   Argenprop
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Scraping/2_HTTP_Avanzado/scraping_extra_tips.html">
   Tips para scrapear mejor
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../Scraping/3_Selenium_y_xpath/scraping_por_automatizacion.html">
   Scraping por Automatización con Selenium
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  APIs
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../APIs/README.html">
   APIs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../APIs/1_APIs_Geograficas/clase-1.html">
   APIs geográficas
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../APIs/1_APIs_Geograficas/clase-1-ejercicios.html">
   APIs Geográficas: Ejercicios
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../APIs/2_APIs_Series_Tiempo/clase-2.html">
   APIs de Series de Tiempo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../APIs/2_APIs_Series_Tiempo/ejercicios/ejercicios.html">
   APIs Series de Tiempo: Ejercicios
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Análisis de Datos
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/README.html">
   Analisis de datos con Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/1_Indexing/Indexing.html">
   Indexación y Agregación
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/1_Indexing/ejercicio/ejercicio.html">
   Ejercicios Pandas I
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/2_Pivot_Table_y_Joins/clase-2.html">
   Pivot tables y joins
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/2_Pivot_Table_y_Joins/clase-2-ejercicios.html">
   Ejercicios Pandas II
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/3_Agrupacion_y_Agregacion/agrupacion_agregacion.html">
   Agrupación
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/3_Agrupacion_y_Agregacion/ejercicio/ejercicio.html">
   Ejercicios Pandas III
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/4_Data_Wrangling_Avanzado/data_wrangling_avanzado.html">
   Data Wrangling Avanzado
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/4_Data_Wrangling_Avanzado/ejercicio/ejercicio.html">
   Ejercicio Pandas IV: Informe macroeconómico de Argentina
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/5_Visualizacion/Visualizacion_Pandas.html">
   Visualización con Pandas y Matplotlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/5_Visualizacion/Visualizacion_Plotly.html">
   Visualización con Plotly
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../AnalisisDeDatos/5_Visualizacion/Ejercitacion/Ejercitacion_Extra.html">
   Ejercicios Visualización
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Aprendizaje Automático
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../README.html">
   Machine Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../1_Introduccion/rls.html">
   Regresión Lineal Simple
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../2_RegresionLinealMultiple/RegresionLinealMultiple.html">
   Regresión Lineal Múltiple
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Regularización - Optimización - Feature Engineering - Pipelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../5_KNNyArbolesDeDecision/KNN_Arboles.html">
   Modelos no paramétricos: K-Nearest Neighbours y Árboles de decisión
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../6_Ensamble/Bagging%26Boosting.html">
   Ensambles: Bagging &amp; Boosting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../8_ShapyAnomalias/anomaly-detection-shap-values.html">
   Detección de anomalías y explicabilidad de modelos con valores SHAP
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../9_SeriesDeTiempo/1.ARIMA.html">
   Series de tiempo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../9_SeriesDeTiempo/2.Prophet.html">
   Prophet
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../10_Recomendacion/sistemas_recomendacion.html">
   Sistemas de Recomendación
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Colaboración
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../General/0_Colaboracion/Guia%20para%20armar%20contenido.html">
   1. Generando contenido
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/MachineLearning/3_Regularizacion/Regularizacion.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://institutohumai.github.io/cursos-python/"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://institutohumai.github.io/cursos-python//issues/new?title=Issue%20on%20page%20%2FMachineLearning/3_Regularizacion/Regularizacion.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#planteo-del-problema">
   Planteo del Problema
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conjunto-de-datos">
   Conjunto de datos
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analsis-exploratorio">
     1. Análsis Exploratorio
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#grafico-de-la-relacion-entre-la-posicion-y-el-salario">
       Gráfico de la relación entre la posición y el salario
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#correlograma">
       Correlograma
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analisis-de-distribucion-scatterplot-y-correlacion-de-algunas-variables">
     Analisis de Distribución, Scatterplot y correlación de algunas variables
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modelo-lineal">
   Modelo Lineal
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creacion-de-las-variables-dummies">
     Creación de las variables dummies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#coeficientes-estimados">
     Coeficientes estimados
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#particion-train-y-test">
     3.1 Partición Train y Test
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lasso">
     3.2 Lasso
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ridge">
     3.3 Ridge
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#elastic-net">
     3.4 Elastic Net
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparacion-de-modelos">
     3.5 Comparación de Modelos
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimizacion-de-hiperparametros">
   4. Optimización de Hiperparámetros
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#busqueda-de-grilla-o-grid-search">
     4.1 Búsqueda de Grilla o Grid-search
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#busqueda-aleatoria-o-random-search">
     4.2 Búsqueda aleatoria o Random Search
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparacion-de-optimizadores">
     4.3 Comparación de Optimizadores
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-engineering">
   5. Feature Engineering
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imputacion-de-datos-faltantes">
     5.1 Imputación de datos faltantes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#binning">
     5.2 Binning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#one-hot-encoding">
     5.3 One-hot Encoding
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#agrupacion">
     5.4 Agrupación
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#escalado-de-datos">
     5.5 Escalado de Datos
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pipelines">
   6. Pipelines
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Regularización - Optimización - Feature Engineering - Pipelines</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#planteo-del-problema">
   Planteo del Problema
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conjunto-de-datos">
   Conjunto de datos
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analsis-exploratorio">
     1. Análsis Exploratorio
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#grafico-de-la-relacion-entre-la-posicion-y-el-salario">
       Gráfico de la relación entre la posición y el salario
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#correlograma">
       Correlograma
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analisis-de-distribucion-scatterplot-y-correlacion-de-algunas-variables">
     Analisis de Distribución, Scatterplot y correlación de algunas variables
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modelo-lineal">
   Modelo Lineal
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creacion-de-las-variables-dummies">
     Creación de las variables dummies
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#coeficientes-estimados">
     Coeficientes estimados
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#particion-train-y-test">
     3.1 Partición Train y Test
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lasso">
     3.2 Lasso
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ridge">
     3.3 Ridge
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#elastic-net">
     3.4 Elastic Net
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparacion-de-modelos">
     3.5 Comparación de Modelos
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#optimizacion-de-hiperparametros">
   4. Optimización de Hiperparámetros
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#busqueda-de-grilla-o-grid-search">
     4.1 Búsqueda de Grilla o Grid-search
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#busqueda-aleatoria-o-random-search">
     4.2 Búsqueda aleatoria o Random Search
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparacion-de-optimizadores">
     4.3 Comparación de Optimizadores
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-engineering">
   5. Feature Engineering
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#imputacion-de-datos-faltantes">
     5.1 Imputación de datos faltantes
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#binning">
     5.2 Binning
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#one-hot-encoding">
     5.3 One-hot Encoding
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#agrupacion">
     5.4 Agrupación
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#escalado-de-datos">
     5.5 Escalado de Datos
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pipelines">
   6. Pipelines
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <p><a href="https://colab.research.google.com/github/institutohumai/cursos-python/blob/master/MachineLearning/3_Regularizacion/Regularizacion.ipynb"> <img src='https://colab.research.google.com/assets/colab-badge.svg' /> </a></p>
<div align="center"> Recordá abrir en una nueva pestaña </div><div class="tex2jax_ignore mathjax_ignore section" id="regularizacion-optimizacion-feature-engineering-pipelines">
<h1>Regularización - Optimización - Feature Engineering - Pipelines<a class="headerlink" href="#regularizacion-optimizacion-feature-engineering-pipelines" title="Permalink to this headline">¶</a></h1>
<div class="section" id="planteo-del-problema">
<h2>Planteo del Problema<a class="headerlink" href="#planteo-del-problema" title="Permalink to this headline">¶</a></h2>
<p>El problema que vamos a tratar de resolver es de <strong>predecir</strong> el <strong>salario</strong> de un <strong>jugador de la NBA</strong> de la temporada 2019-2020 en base a sus estadísticas de juego durante la temporada</p>
<p>Las técnicas de <strong>regularización</strong> son útiles para trabajar con conjuntos con <strong>gran cantidad de variables</strong>, las cuales pueden introducir variabilidad en las estimaciones de los parámetros.</p>
</div>
<div class="section" id="conjunto-de-datos">
<h2>Conjunto de datos<a class="headerlink" href="#conjunto-de-datos" title="Permalink to this headline">¶</a></h2>
<p>Los datos provienen de la página  <a class="reference external" href="https://www.basketball-reference.com/">Basketball Reference</a> y fueron previamente trabajados por nosotros para obtener el formato actual.</p>
<p>Las variables del set son:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">cycle</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#definimos la semilla</span>
<span class="n">semilla</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Obtenemos el nombre de las variables</span>
<span class="c1">### Cambiar nombre</span>

<span class="n">diccionario</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="s1">&#39;https://datasets-humai.s3.amazonaws.com/datasets/diccionario_terminos.xlsx&#39;</span><span class="p">)</span>
<span class="n">diccionario</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>variable</th>
      <th>descripcion</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>player</td>
      <td>nombre</td>
    </tr>
    <tr>
      <th>1</th>
      <td>salary</td>
      <td>Salario</td>
    </tr>
    <tr>
      <th>2</th>
      <td>position</td>
      <td>Posicion en el campo de juego</td>
    </tr>
    <tr>
      <th>3</th>
      <td>age</td>
      <td>Edad</td>
    </tr>
    <tr>
      <th>4</th>
      <td>team_id</td>
      <td>Nombre del Equipo</td>
    </tr>
    <tr>
      <th>5</th>
      <td>g</td>
      <td>Cantidad de Partidos</td>
    </tr>
    <tr>
      <th>6</th>
      <td>gs</td>
      <td>Partidos como titular</td>
    </tr>
    <tr>
      <th>7</th>
      <td>mp_per_g</td>
      <td>minutos por partido</td>
    </tr>
    <tr>
      <th>8</th>
      <td>fg_per_g</td>
      <td>Tiros de campo por partido (dobles y triples)</td>
    </tr>
    <tr>
      <th>9</th>
      <td>fga_per_g</td>
      <td>Intentos de tiro de campo</td>
    </tr>
    <tr>
      <th>10</th>
      <td>fg_pct</td>
      <td>Porcentaje de tiros convertido</td>
    </tr>
    <tr>
      <th>11</th>
      <td>fg3_per_g</td>
      <td>Triples por partido</td>
    </tr>
    <tr>
      <th>12</th>
      <td>fg3a_per_g</td>
      <td>Intentos de triples por partido</td>
    </tr>
    <tr>
      <th>13</th>
      <td>fg3_pct</td>
      <td>% de Triples convertidos</td>
    </tr>
    <tr>
      <th>14</th>
      <td>fg2_per_g</td>
      <td>Dobles por partido</td>
    </tr>
    <tr>
      <th>15</th>
      <td>fg2a_per_g</td>
      <td>Intentos de dobles por partido</td>
    </tr>
    <tr>
      <th>16</th>
      <td>fg2_pct</td>
      <td>% de Dobles convertidos</td>
    </tr>
    <tr>
      <th>17</th>
      <td>efg_pct</td>
      <td>Efectividad de tiros de campo</td>
    </tr>
    <tr>
      <th>18</th>
      <td>ft_per_g</td>
      <td>Tiros libres por partido</td>
    </tr>
    <tr>
      <th>19</th>
      <td>fta_per_g</td>
      <td>Intentos de tiro libre por partido</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ft_pct</td>
      <td>% de Tiros libres convertidos</td>
    </tr>
    <tr>
      <th>21</th>
      <td>orb_per_g</td>
      <td>Rebotes ofensivos por partido</td>
    </tr>
    <tr>
      <th>22</th>
      <td>drb_per_g</td>
      <td>Rebotes defensivos por partido</td>
    </tr>
    <tr>
      <th>23</th>
      <td>trb_per_g</td>
      <td>Rebotes totales por partido</td>
    </tr>
    <tr>
      <th>24</th>
      <td>ast_per_g</td>
      <td>Asistencias por partido</td>
    </tr>
    <tr>
      <th>25</th>
      <td>stl_per_g</td>
      <td>Robos por partido</td>
    </tr>
    <tr>
      <th>26</th>
      <td>blk_per_g</td>
      <td>Bloqueos por partido</td>
    </tr>
    <tr>
      <th>27</th>
      <td>tov_per_g</td>
      <td>Perdidas por partido</td>
    </tr>
    <tr>
      <th>28</th>
      <td>pf_per_g</td>
      <td>Faltas por partido</td>
    </tr>
    <tr>
      <th>29</th>
      <td>pts_per_g</td>
      <td>Puntos por partido</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>En el glosario de <a class="reference external" href="https://www.basketball-reference.com/">Basketball Reference</a> pueden encontrar una descripción más exhaustiva de cada una de estas métricas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Lectura del dataset</span>

<span class="n">nba</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://datasets-humai.s3.amazonaws.com/datasets/nba_salarios_2021.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Limpiamos algunas de las variables</span>
<span class="n">nba</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nba</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-.*&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">nba</span> <span class="o">=</span> <span class="n">nba</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Observamos la informacion del dataset</span>
<span class="n">nba</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 403 entries, 0 to 402
Data columns (total 30 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   player      403 non-null    object 
 1   salary      403 non-null    float64
 2   position    403 non-null    object 
 3   age         403 non-null    int64  
 4   team_id     403 non-null    object 
 5   g           403 non-null    int64  
 6   gs          403 non-null    int64  
 7   mp_per_g    403 non-null    float64
 8   fg_per_g    403 non-null    float64
 9   fga_per_g   403 non-null    float64
 10  fg_pct      403 non-null    float64
 11  fg3_per_g   403 non-null    float64
 12  fg3a_per_g  403 non-null    float64
 13  fg3_pct     403 non-null    float64
 14  fg2_per_g   403 non-null    float64
 15  fg2a_per_g  403 non-null    float64
 16  fg2_pct     403 non-null    float64
 17  efg_pct     403 non-null    float64
 18  ft_per_g    403 non-null    float64
 19  fta_per_g   403 non-null    float64
 20  ft_pct      403 non-null    float64
 21  orb_per_g   403 non-null    float64
 22  drb_per_g   403 non-null    float64
 23  trb_per_g   403 non-null    float64
 24  ast_per_g   403 non-null    float64
 25  stl_per_g   403 non-null    float64
 26  blk_per_g   403 non-null    float64
 27  tov_per_g   403 non-null    float64
 28  pf_per_g    403 non-null    float64
 29  pts_per_g   403 non-null    float64
dtypes: float64(24), int64(3), object(3)
memory usage: 94.6+ KB
</pre></div>
</div>
</div>
</div>
<div class="section" id="analsis-exploratorio">
<h3>1. Análsis Exploratorio<a class="headerlink" href="#analsis-exploratorio" title="Permalink to this headline">¶</a></h3>
<div class="section" id="grafico-de-la-relacion-entre-la-posicion-y-el-salario">
<h4>Gráfico de la relación entre la posición y el salario<a class="headerlink" href="#grafico-de-la-relacion-entre-la-posicion-y-el-salario" title="Permalink to this headline">¶</a></h4>
<p>Veamos como es la distribución de salarios según la posición de juego. Se agregan las etiquetas de los jugadores que cobran mayores sueldos <strong>buscar forma de agregar labels no muy compleja</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graficamos la relacion entre las posicion y el salario del jugador </span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;position&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;salary&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">nba</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Boxplots: salarios y posición de juego&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Salario&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Posición&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_12_0.png" src="../../_images/Regularizacion_12_0.png" />
</div>
</div>
<p>Observamos que la distribucion varía un poco entre las posiciones y hay varios jugadores que son outliers.</p>
</div>
<div class="section" id="correlograma">
<h4>Correlograma<a class="headerlink" href="#correlograma" title="Permalink to this headline">¶</a></h4>
<p>Realizamos un correlograma entre todas las variables cuantitativas</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtenemos las variables numericas y generamos la matriz de correlacion</span>
<span class="n">nba_numericas</span> <span class="o">=</span> <span class="n">nba</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span>
<span class="n">matriz_correlacion</span> <span class="o">=</span> <span class="n">nba_numericas</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graficamos la correlacion entre las variables</span>

<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">matriz_correlacion</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span><span class="o">=</span> <span class="kc">True</span>

<span class="n">f</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">17</span><span class="p">))</span>

<span class="n">heatmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">matriz_correlacion</span><span class="p">,</span>
                      <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">,</span>
                      <span class="n">square</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">linewidths</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span><span class="p">,</span>
                      <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span>
                      <span class="n">cbar_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;shrink&#39;</span><span class="p">:</span> <span class="o">.</span><span class="mi">4</span><span class="p">,</span>
                                <span class="s1">&#39;ticks&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span>
                      <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;fontsize&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">matriz_correlacion</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">matriz_correlacion</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">({</span><span class="s1">&#39;xtick.bottom&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="p">{</span><span class="s1">&#39;ytick.left&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_15_0.png" src="../../_images/Regularizacion_15_0.png" />
</div>
</div>
<p>Observamos que existen relaciones de diversa magnitud y signo entre todas las variables.</p>
</div>
</div>
<div class="section" id="analisis-de-distribucion-scatterplot-y-correlacion-de-algunas-variables">
<h3>Analisis de Distribución, Scatterplot y correlación de algunas variables<a class="headerlink" href="#analisis-de-distribucion-scatterplot-y-correlacion-de-algunas-variables" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Seleccionamos algunas variables y graficamos su correlacion </span>

<span class="n">nba_numericas_seleccion</span> <span class="o">=</span> <span class="n">nba_numericas</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">,</span><span class="s1">&#39;age&#39;</span><span class="p">,</span><span class="s1">&#39;pts_per_g&#39;</span><span class="p">,</span><span class="s1">&#39;gs&#39;</span><span class="p">,</span><span class="s1">&#39;ast_per_g&#39;</span><span class="p">,</span><span class="s1">&#39;blk_per_g&#39;</span><span class="p">]]</span>

<span class="k">def</span> <span class="nf">corr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    
    <span class="c1"># Calculamos el valor de la correlacion</span>
    <span class="n">coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Generamos la etiqueta</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\rho$ = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">coef</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># Agregamos la etiqueta al grafico</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">xy</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">),</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">xycoords</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    

<span class="c1"># Mapeamos los graficos en las ubicaciones correspondientes</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">(</span><span class="n">nba_numericas_seleccion</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map_upper</span><span class="p">(</span><span class="n">corr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.PairGrid at 0x7f9927f2e650&gt;
</pre></div>
</div>
<img alt="../../_images/Regularizacion_17_1.png" src="../../_images/Regularizacion_17_1.png" />
</div>
</div>
<p>Se puede observar que el <strong>salario</strong> se correlaciona de forma positiva con todas las variables.
Tambien se puede ver una <strong>correlacion positiva</strong> entre los <strong>pts_per_g</strong> (puntos por partido) y <strong>ast_per_g</strong> (asistencia por partido)</p>
</div>
</div>
<div class="section" id="modelo-lineal">
<h2>Modelo Lineal<a class="headerlink" href="#modelo-lineal" title="Permalink to this headline">¶</a></h2>
<p>Vamos a ajustar un modelo lineal que incluya todas las variables (excepto el nombre del jugaodr y del equipo) y obtendremos todos los parámetros del modelo junto al valor de su intervalo de confianza</p>
<p><span class="math notranslate nohighlight">\(E(salario|.) = \beta_0 + \beta_1 \cdot age + \beta_2 \cdot g + ... + \beta_n \cdot position\_SG\)</span></p>
<div class="section" id="creacion-de-las-variables-dummies">
<h3>Creación de las variables dummies<a class="headerlink" href="#creacion-de-las-variables-dummies" title="Permalink to this headline">¶</a></h3>
<p>Para crear las variables dummies vamos a utilizar el transformer (es un tipo de clase) <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html">OneHotEncoder</a>. Los argumentos que vamos a utilizar son:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">categories:</span></code> la lista de categorías que tiene la variable categórica</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">drop='first'</span></code>: indica que se va a “tirar” la primera categoría (es la que queda contenida en el intercepto)</p></li>
</ul>
</div>
<div class="section" id="coeficientes-estimados">
<h3>Coeficientes estimados<a class="headerlink" href="#coeficientes-estimados" title="Permalink to this headline">¶</a></h3>
<p>Creamos el modelo y accedemos a la información de los coeficientes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Eliminamos las variables del nombre del jugador y el equipo</span>
<span class="n">nba_lineal</span> <span class="o">=</span> <span class="n">nba</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;player&#39;</span><span class="p">,</span><span class="s1">&#39;team_id&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seleccionamos las variables numericas</span>
<span class="n">nba_lineal_numericas</span> <span class="o">=</span> <span class="n">nba_lineal</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seleccionamos las variables categoricas y las convertimos en dummies </span>
<span class="n">nba_lineal_cat</span> <span class="o">=</span> <span class="n">nba_lineal</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nba_lineal_cat</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;PG&#39;, &#39;SG&#39;, &#39;PF&#39;, &#39;SF&#39;, &#39;C&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definimos una instancia del transformer</span>
<span class="n">one_hot_encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">categories</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;PG&#39;</span><span class="p">,</span> <span class="s1">&#39;SG&#39;</span><span class="p">,</span> <span class="s1">&#39;PF&#39;</span><span class="p">,</span> <span class="s1">&#39;SF&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">]],</span> <span class="n">drop</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Realizamos el fit con los datos de entrenamiento</span>
<span class="n">one_hot_encoder</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nba_lineal_cat</span><span class="p">[[</span><span class="s1">&#39;position&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OneHotEncoder(categories=[[&#39;PG&#39;, &#39;SG&#39;, &#39;PF&#39;, &#39;SF&#39;, &#39;C&#39;]], drop=&#39;first&#39;,
              dtype=&lt;class &#39;numpy.float64&#39;&gt;, handle_unknown=&#39;error&#39;,
              sparse=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Accedemos a las categorias del encoder</span>
<span class="n">one_hot_encoder</span><span class="o">.</span><span class="n">categories_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[array([&#39;PG&#39;, &#39;SG&#39;, &#39;PF&#39;, &#39;SF&#39;, &#39;C&#39;], dtype=object)]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="c1"># Generamos las variables dummies de la variable property type (notemos que tenemos 2 columnas!)</span>
 <span class="n">matriz_dummies</span> <span class="o">=</span> <span class="n">one_hot_encoder</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">nba_lineal_cat</span><span class="p">[[</span><span class="s1">&#39;position&#39;</span><span class="p">]])</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
 <span class="n">matriz_dummies</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[0., 0., 0., 0.],
       [0., 0., 0., 0.],
       [0., 0., 0., 0.],
       ...,
       [1., 0., 0., 0.],
       [0., 0., 0., 0.],
       [0., 0., 0., 1.]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generamos los nombres de las variables dummies (notemos que tenemos 2 columnas!)</span>
<span class="n">nombres_dummies</span> <span class="o">=</span> <span class="n">one_hot_encoder</span><span class="o">.</span><span class="n">get_feature_names</span><span class="p">([</span><span class="s1">&#39;position&#39;</span><span class="p">])</span>
<span class="n">nombres_dummies</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;position_SG&#39;, &#39;position_PF&#39;, &#39;position_SF&#39;, &#39;position_C&#39;],
      dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generamos el dataframe con las variables dummies con las matrices y columnas</span>
<span class="n">df_dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">matriz_dummies</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">nombres_dummies</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">nba_lineal_cat</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">df_dummies</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>position_SG</th>
      <th>position_PF</th>
      <th>position_SF</th>
      <th>position_C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Separamos las variables predictoras de la que va a ser preditcha &#39;salary&#39;</span>
<span class="n">nba_lineal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">nba_lineal_numericas</span><span class="p">,</span> <span class="n">df_dummies</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">nba_lineal</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;salary&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">reg_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">nba_lineal</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import el paquete sm de la libreria stats</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.api</span> <span class="kn">import</span> <span class="n">add_constant</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construimos el modelo agregando una constante</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">X</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error Cuadratico Medio de los Residuos</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ECM: </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">mse_resid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ECM: 31832279898386.086
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualizamos el ajuste final</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                 salary   R-squared:                       0.666
Model:                            OLS   Adj. R-squared:                  0.640
Method:                 Least Squares   F-statistic:                     24.78
Date:                Mon, 12 Jul 2021   Prob (F-statistic):           8.41e-71
Time:                        22:52:09   Log-Likelihood:                -6820.6
No. Observations:                 403   AIC:                         1.370e+04
Df Residuals:                     372   BIC:                         1.383e+04
Df Model:                          30                                         
Covariance Type:            nonrobust                                         
===============================================================================
                  coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------
const       -1.341e+07    4.1e+06     -3.271      0.001   -2.15e+07   -5.35e+06
age          5.533e+05   7.82e+04      7.071      0.000    3.99e+05    7.07e+05
g           -5.699e+04   1.98e+04     -2.871      0.004    -9.6e+04    -1.8e+04
gs           4.189e+04   1.98e+04      2.117      0.035    2980.828    8.08e+04
mp_per_g    -1.689e+05    1.2e+05     -1.411      0.159   -4.04e+05    6.64e+04
fg_per_g     4.826e+06   9.05e+06      0.533      0.594    -1.3e+07    2.26e+07
fga_per_g    2.052e+07   6.37e+06      3.220      0.001    7.99e+06    3.31e+07
fg_pct       7.812e+06   1.89e+07      0.413      0.680   -2.94e+07     4.5e+07
fg3_per_g   -7.211e+06   8.03e+06     -0.898      0.370    -2.3e+07    8.58e+06
fg3a_per_g  -1.905e+07   6.37e+06     -2.992      0.003   -3.16e+07   -6.53e+06
fg3_pct     -2.023e+06   3.14e+06     -0.644      0.520    -8.2e+06    4.16e+06
fg2_per_g    -5.45e+06   6.78e+06     -0.804      0.422   -1.88e+07    7.88e+06
fg2a_per_g  -2.022e+07   6.42e+06     -3.149      0.002   -3.29e+07    -7.6e+06
fg2_pct     -2.025e+06    7.7e+06     -0.263      0.793   -1.72e+07    1.31e+07
efg_pct     -6.329e+06   1.82e+07     -0.348      0.728   -4.21e+07    2.95e+07
ft_per_g     2.373e+06   3.96e+06      0.599      0.550   -5.42e+06    1.02e+07
fta_per_g   -1.613e+06   1.25e+06     -1.290      0.198   -4.07e+06    8.45e+05
ft_pct      -5.737e+05    2.6e+06     -0.221      0.825   -5.68e+06    4.53e+06
orb_per_g    6.872e+06    6.2e+06      1.109      0.268   -5.31e+06    1.91e+07
drb_per_g    7.157e+06   6.13e+06      1.168      0.244   -4.89e+06    1.92e+07
trb_per_g   -6.304e+06   6.12e+06     -1.031      0.303   -1.83e+07    5.72e+06
ast_per_g    9.666e+05   3.86e+05      2.506      0.013    2.08e+05    1.73e+06
stl_per_g    3.762e+06   1.13e+06      3.331      0.001    1.54e+06    5.98e+06
blk_per_g    5.363e+05   1.03e+06      0.522      0.602   -1.48e+06    2.56e+06
tov_per_g   -7.605e+05   1.04e+06     -0.733      0.464    -2.8e+06    1.28e+06
pf_per_g    -1.402e+06   6.52e+05     -2.151      0.032   -2.68e+06   -1.21e+05
pts_per_g    6.471e+05    3.8e+06      0.170      0.865   -6.83e+06    8.13e+06
position_SG  1.198e+06   1.13e+06      1.060      0.290   -1.02e+06    3.42e+06
position_PF  2.594e+06   1.33e+06      1.947      0.052   -2.51e+04    5.21e+06
position_SF  2.774e+06   1.28e+06      2.166      0.031    2.55e+05    5.29e+06
position_C   2.756e+06   1.61e+06      1.710      0.088   -4.13e+05    5.92e+06
==============================================================================
Omnibus:                       22.840   Durbin-Watson:                   1.119
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               55.764
Skew:                           0.232   Prob(JB):                     7.78e-13
Kurtosis:                       4.763   Cond. No.                     6.49e+03
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 6.49e+03. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">coef_summary</span><span class="p">(</span><span class="n">results</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Toma los resultado del modelo de OLS </span>
<span class="sd">    </span>
<span class="sd">    Elimina el intercepto.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Creo un dataframe de los resultados del summary </span>
    <span class="n">coef_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1"># Agrego el nombre de las columnas</span>
    <span class="n">coef_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Elimino la fila extra del intercepto</span>
    <span class="n">coef_df</span><span class="o">=</span><span class="n">coef_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Seteo el nombre de las variables como index</span>
    <span class="n">coef_df</span> <span class="o">=</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">coef_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Convertimos a float los object </span>
    <span class="n">coef_df</span> <span class="o">=</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1"># Obtenemos el error; (coef - limite inferior del IC)</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="n">coef_df</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">coef_df</span><span class="p">[</span><span class="s1">&#39;[0.025&#39;</span><span class="p">]</span>
    
    <span class="c1"># Agregamos los errores al dataframe</span>
    <span class="n">coef_df</span><span class="p">[</span><span class="s1">&#39;errors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">errors</span>

    <span class="c1"># Eliminamos la variable const</span>
    <span class="n">coef_df</span> <span class="o">=</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">])</span>

    <span class="c1"># Ordenamos los coeficientes </span>
    <span class="n">coef_df</span> <span class="o">=</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;coef&#39;</span><span class="p">])</span>

    <span class="c1">### Graficamos ###</span>

    <span class="c1"># x-labels</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">coef_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    
    <span class="c1"># Agregamos la columna con el nombre de las variables</span>
    <span class="n">coef_df</span><span class="p">[</span><span class="s1">&#39;variables&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variables</span>
   
    <span class="k">return</span>  <span class="n">coef_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Aplicamos la funcion coef_summary a los results</span>

<span class="n">coef_df</span> <span class="o">=</span> <span class="n">coef_summary</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Graficamos los p-valores de mayor a menor para evaluar la significatividad individual de los coeficientes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graficamos los p-valor</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">coef_df</span> <span class="o">=</span> <span class="n">coef_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;P&gt;|t|&#39;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;variables&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;P&gt;|t|&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">coef_df</span><span class="p">,</span>
                 <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Spectral&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;P-valor de los regresores&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;P-valor&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;variables&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_38_0.png" src="../../_images/Regularizacion_38_0.png" />
</div>
</div>
<p>Notamos que:</p>
<ul class="simple">
<li><p>Solo algunas variables tienen coeficientes significativos: <strong>gs</strong>,  <strong>pf_per_g</strong>, <strong>ast_per_g</strong>, <strong>g</strong>, <strong>position_SG</strong>, <strong>fg3a_per_g</strong>, <strong>fg2a_per_g</strong>, <strong>fga_per_g</strong>, <strong>position_PG</strong>, <strong>stl_per_g</strong>, <strong>age</strong></p></li>
</ul>
<p>Para evitar los problemas que puede introducir la escala, reescalamos las variables y repetimos el ajuste para estos nuevos datos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Importamos StandardScaler de la libreria sklear</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instanciamos la funcion para escalar</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seleccionamos las variables numericas</span>
<span class="n">nba_lineal</span> <span class="o">=</span> <span class="n">nba</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;player&#39;</span><span class="p">,</span><span class="s1">&#39;team_id&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">nba_lineal_numericas</span> <span class="o">=</span> <span class="n">nba_lineal</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span>
<span class="c1"># Eliminamos la variable salary del escalado</span>
<span class="n">nba_lineal_numericas</span><span class="o">=</span> <span class="n">nba_lineal_numericas</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;salary&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">nba_lineal_numericas_columns</span> <span class="o">=</span> <span class="n">nba_lineal_numericas</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Escalamos las variables</span>
<span class="n">scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">nba_lineal_numericas</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generamos un dataframe con las variables escaladas</span>
<span class="n">nba_lineal_numericas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaled</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">nba_lineal_numericas_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generamos dummies con las variables categoricas </span>
<span class="n">nba_lineal_cat</span> <span class="o">=</span> <span class="n">nba_lineal</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">])</span>
<span class="n">nba_lineal_cat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">nba_lineal_cat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generamos el conjunto de datos para ajustar el modelo</span>
<span class="n">nba_lineal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">nba_lineal_numericas</span><span class="p">,</span> <span class="n">df_dummies</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                   
<span class="n">X</span> <span class="o">=</span> <span class="n">nba_lineal</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">nba</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Construimos el modelo agregando una constante</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">model_scaled</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">X</span><span class="p">)</span>
<span class="n">results_scaled</span> <span class="o">=</span> <span class="n">model_scaled</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Error Cuadratico Medio de los Residuos</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ECM: </span><span class="si">{</span><span class="n">results_scaled</span><span class="o">.</span><span class="n">mse_resid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ECM: 31832279898386.098
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualizamos el ajuste final</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results_scaled</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>                            OLS Regression Results                            
==============================================================================
Dep. Variable:                 salary   R-squared:                       0.666
Model:                            OLS   Adj. R-squared:                  0.640
Method:                 Least Squares   F-statistic:                     24.78
Date:                Mon, 12 Jul 2021   Prob (F-statistic):           8.41e-71
Time:                        22:52:10   Log-Likelihood:                -6820.6
No. Observations:                 403   AIC:                         1.370e+04
Df Residuals:                     372   BIC:                         1.383e+04
Df Model:                          30                                         
Covariance Type:            nonrobust                                         
===============================================================================
                  coef    std err          t      P&gt;|t|      [0.025      0.975]
-------------------------------------------------------------------------------
const        6.904e+06   1.01e+06      6.862      0.000    4.93e+06    8.88e+06
age          2.224e+06   3.14e+05      7.071      0.000    1.61e+06    2.84e+06
g           -1.106e+06   3.85e+05     -2.871      0.004   -1.86e+06   -3.49e+05
gs           1.046e+06   4.94e+05      2.117      0.035    7.45e+04    2.02e+06
mp_per_g    -1.404e+06   9.95e+05     -1.411      0.159   -3.36e+06    5.53e+05
fg_per_g     1.086e+07   2.04e+07      0.533      0.594   -2.92e+07    5.09e+07
fga_per_g    9.726e+07   3.02e+07      3.220      0.001    3.79e+07    1.57e+08
fg_pct       6.549e+05   1.59e+06      0.413      0.680   -2.46e+06    3.77e+06
fg3_per_g    -6.38e+06    7.1e+06     -0.898      0.370   -2.03e+07    7.59e+06
fg3a_per_g  -4.365e+07   1.46e+07     -2.992      0.003   -7.23e+07    -1.5e+07
fg3_pct     -2.543e+05   3.95e+05     -0.644      0.520   -1.03e+06    5.23e+05
fg2_per_g   -1.023e+07   1.27e+07     -0.804      0.422   -3.52e+07    1.48e+07
fg2a_per_g      -7e+07   2.22e+07     -3.149      0.002   -1.14e+08   -2.63e+07
fg2_pct     -1.773e+05   6.74e+05     -0.263      0.793    -1.5e+06    1.15e+06
efg_pct     -4.739e+05   1.36e+06     -0.348      0.728   -3.15e+06    2.21e+06
ft_per_g     3.515e+06   5.87e+06      0.599      0.550   -8.03e+06    1.51e+07
fta_per_g   -2.935e+06   2.27e+06     -1.290      0.198   -7.41e+06    1.54e+06
ft_pct      -8.286e+04   3.75e+05     -0.221      0.825    -8.2e+05    6.54e+05
orb_per_g    5.348e+06   4.82e+06      1.109      0.268   -4.14e+06    1.48e+07
drb_per_g    1.343e+07   1.15e+07      1.168      0.244   -9.18e+06     3.6e+07
trb_per_g   -1.577e+07   1.53e+07     -1.031      0.303   -4.58e+07    1.43e+07
ast_per_g    1.802e+06   7.19e+05      2.506      0.013    3.88e+05    3.22e+06
stl_per_g    1.491e+06   4.47e+05      3.331      0.001    6.11e+05    2.37e+06
blk_per_g    2.321e+05   4.45e+05      0.522      0.602   -6.42e+05    1.11e+06
tov_per_g   -6.339e+05   8.64e+05     -0.733      0.464   -2.33e+06    1.07e+06
pf_per_g    -1.038e+06   4.82e+05     -2.151      0.032   -1.99e+06   -8.93e+04
pts_per_g    4.109e+06   2.42e+07      0.170      0.865   -4.34e+07    5.16e+07
position_SG  1.198e+06   1.13e+06      1.060      0.290   -1.02e+06    3.42e+06
position_PF  2.594e+06   1.33e+06      1.947      0.052   -2.51e+04    5.21e+06
position_SF  2.774e+06   1.28e+06      2.166      0.031    2.55e+05    5.29e+06
position_C   2.756e+06   1.61e+06      1.710      0.088   -4.13e+05    5.92e+06
==============================================================================
Omnibus:                       22.840   Durbin-Watson:                   1.119
Prob(Omnibus):                  0.000   Jarque-Bera (JB):               55.764
Skew:                           0.232   Prob(JB):                     7.78e-13
Kurtosis:                       4.763   Cond. No.                         497.
==============================================================================

Warnings:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Graficamos los coeficientes al 95% de confianza</span>
<span class="n">coef_df_scaled</span> <span class="o">=</span> <span class="n">coef_summary</span><span class="p">(</span><span class="n">results_scaled</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graficamos los p-valor</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">coef_df_scaled</span> <span class="o">=</span> <span class="n">coef_df_scaled</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;P&gt;|t|&#39;</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;variables&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;P&gt;|t|&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">coef_df_scaled</span><span class="p">,</span>
                 <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Spectral&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;P-valor de los regresores&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;P-valor&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;variables&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_51_0.png" src="../../_images/Regularizacion_51_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE Scaled: </span><span class="si">{</span><span class="n">results_scaled</span><span class="o">.</span><span class="n">rsquared</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;vs.&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot;MSE: </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">rsquared</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Adj MSE Scaled: </span><span class="si">{</span><span class="n">results_scaled</span><span class="o">.</span><span class="n">rsquared_adj</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;vs.&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot; Adj MSE: </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">rsquared_adj</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-value Scaled: </span><span class="si">{</span><span class="n">results_scaled</span><span class="o">.</span><span class="n">f_pvalue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;vs.&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s2">&quot; p-value: </span><span class="si">{</span><span class="n">results</span><span class="o">.</span><span class="n">f_pvalue</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE Scaled: 0.6664671283621362 vs. MSE: 0.6664671283621363
Adj MSE Scaled: 0.6395693161332763 vs.  Adj MSE: 0.6395693161332763
p-value Scaled: 8.414522406673801e-71 vs.  p-value: 8.414522406673322e-71
</pre></div>
</div>
</div>
</div>
<p>La alta cantidad de variables y la existencia de una alta correlación entre varias de ellas ocasionan que los coeficientes estimados tengan alta varianza y que muchos de ellos no sean significativos en términos estadísticos. Las técnicas de <strong>regularización</strong> pueden ayudarnos a mejorar esta situación.</p>
<p>##3. Regularización</p>
<p>La librería scikit-learn (sklearn) nos permite trabajar con modelos Ridge, Lasso y Elastic Net. Para cada uno de ellas tendremos una función particular para poder llevar adelante el cálculo</p>
<p><strong>Fórmula</strong></p>
<p><em>ECM</em> + <span class="math notranslate nohighlight">\(\lambda\)</span> [ <span class="math notranslate nohighlight">\(\alpha\)</span> <span class="math notranslate nohighlight">\(\Sigma_{j}\)</span>|<span class="math notranslate nohighlight">\(\beta_{j}\)</span>| + (1-<span class="math notranslate nohighlight">\(\alpha\)</span>) <span class="math notranslate nohighlight">\(\Sigma_{j}\)</span><span class="math notranslate nohighlight">\(\beta_{j}^{2}\)</span>]</p>
<p><span class="math notranslate nohighlight">\(\lambda\)</span> controla toda la penalidad, mientras que <span class="math notranslate nohighlight">\(\alpha\)</span> controla la penalidad de la <strong>Elastic Net</strong> y actua como un puente entre <strong>Lasso</strong> y <strong>Ridge</strong></p>
<p>Con el parámentro <span class="math notranslate nohighlight">\(\alpha\)</span> indicamos con qué tipo de modelo deseamos trabajar:</p>
<ul class="simple">
<li><p>Ridge: <span class="math notranslate nohighlight">\(\alpha\)</span> = 0</p></li>
<li><p>Lasso: <span class="math notranslate nohighlight">\(\alpha\)</span> = 1
*Elastic Net: 0 &lt; <span class="math notranslate nohighlight">\(\alpha\)</span> &lt; 1</p></li>
</ul>
</div>
<div class="section" id="particion-train-y-test">
<h3>3.1 Partición Train y Test<a class="headerlink" href="#particion-train-y-test" title="Permalink to this headline">¶</a></h3>
<p>Realizamos una partición entre dataset de entrenamiento y de testeo con la función <em>train_test_split</em> de la librería <em>sklearn</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importamos la funcion trai_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Preparamos el conjunto de datos</span>

<span class="n">nba_reg</span> <span class="o">=</span> <span class="n">nba</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;player&#39;</span><span class="p">,</span><span class="s1">&#39;team_id&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">nba_reg_numericas</span> <span class="o">=</span> <span class="n">nba_reg</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span>
<span class="n">nba_reg_numericas_columns</span> <span class="o">=</span> <span class="n">nba_reg_numericas</span><span class="o">.</span><span class="n">columns</span>

<span class="n">nba_reg_object</span> <span class="o">=</span> <span class="n">df_dummies</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">nba_reg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">nba_reg_numericas</span><span class="p">,</span> <span class="n">nba_reg_object</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                       
<span class="n">X</span> <span class="o">=</span> <span class="n">nba_reg</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;salary&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">nba_reg</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Separamos el conjunto de datos en train y test</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">semilla</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="lasso">
<h3>3.2 Lasso<a class="headerlink" href="#lasso" title="Permalink to this headline">¶</a></h3>
<p>Es un tipo de regularización la cual utiliza la penalización lineal mediante el valor absoluto. La magnitud de la penalización viene dada por el parámetro <span class="math notranslate nohighlight">\(\lambda\)</span>. Si lo pensamos mediante la formula de <em>ElasticNet</em> estariamos utilizando un <span class="math notranslate nohighlight">\(\alpha\)</span> = 1. Para esto vamos a utilizar la función <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Lasso.html">Lasso</a> de sklearn</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta_L}= arg min_\beta\sum_{i=1}^{n}(y_i-\beta_0-\sum_{j=p}^{n}\beta_jx_{ji})^{2}+\lambda\sum_{j=p}^{n}|\beta_j|\)</span></p>
<ol class="simple">
<li><p>Cuál es la penalización que introduce el modelo Lasso?</p></li>
<li><p>Cómo impacta esto en las variables?</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importamos la funcion Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
</pre></div>
</div>
</div>
</div>
<p>Vamos a ver como se van modificando las variables para distintos valores de <span class="math notranslate nohighlight">\(\lambda\)</span> para eso vamos a establecer a generar un número de <span class="math notranslate nohighlight">\(\lambda\)</span> y luego lo vamos a graficar</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># generamos 50 lambdas para evaluar los distintos escenarios</span>
<span class="n">n_alphas</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mf">7.2</span><span class="p">,</span> <span class="n">n_alphas</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ajustamos  la regresion Lasso para los disntos valores de lambda que establecimos</span>
<span class="n">coefs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
    <span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lasso</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Graficamos como varian las variables cuando se aumenta el lambda</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">l1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">coefs</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span> <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Regularización Lasso&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;coeficientes&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Log(lambda)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_64_0.png" src="../../_images/Regularizacion_64_0.png" />
</div>
</div>
<p>Como la regularización <em>Lasso</em> tambien puede ser utilizada como selector de variables, vamos a quedarnos con aquellas variables que sobreviven al proceso final de selección.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Nos quedamos con las variables que sobreviven al proceso de selección</span>
<span class="n">coeficientes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">variables_importantes</span> <span class="o">=</span> <span class="n">coeficientes</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">coeficientes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">45</span><span class="p">:]</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graficamos nuevamente</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">l1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">variables_importantes</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span> <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Regularización Lasso&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">coeficientes</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;coeficientes&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Log(lambda)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_67_0.png" src="../../_images/Regularizacion_67_0.png" />
</div>
</div>
<p>Los métods de regularización no son invariante a la magnitud de los datos. Por este movito es importante standarizar las variables</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instanciamos la funcion para escalar</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Seleccionamos las variables numericas que vamos a escalar</span>
<span class="n">nba_reg</span> <span class="o">=</span> <span class="n">nba</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;player&#39;</span><span class="p">,</span><span class="s1">&#39;team_id&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">nba_reg_numericas</span> <span class="o">=</span> <span class="n">nba_reg</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span>
<span class="n">nba_reg_numericas_columns</span> <span class="o">=</span> <span class="n">nba_reg_numericas</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Escalamos las variables</span>
<span class="n">scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">nba_reg_numericas</span><span class="p">)</span>
<span class="n">nba_reg_numericas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaled</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">nba_reg_numericas_columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Conformamos el nuevo conjunto de entrenamiento</span>
<span class="n">nba_reg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">nba_reg_numericas</span><span class="p">,</span> <span class="n">df_dummies</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                       
<span class="n">X</span> <span class="o">=</span> <span class="n">nba_reg</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;salary&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">nba_reg</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Separamos en train y test</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">semilla</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ajsutamos nuevamente las distintas regresiones Lasso para los alphas planteados</span>
<span class="n">n_alphas</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n_alphas</span><span class="p">)</span>

<span class="n">coefs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
    <span class="n">lasso</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">lasso</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lasso</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graficamos los resultados</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">l1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">coefs</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span> <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Regularización Lasso&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;coeficientes&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Log(lambda)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_75_0.png" src="../../_images/Regularizacion_75_0.png" />
</div>
</div>
<p>Nuevamente seleccionamos aquellas variables que sobreviven al proceso de selección,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Seleccionamos las variables que sobreviven mayor tiempo al proceso de seleccion</span>
<span class="n">coeficientes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">coefs</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="n">variables_importantes</span> <span class="o">=</span> <span class="n">coeficientes</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">coeficientes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">40</span><span class="p">:]</span><span class="o">.</span><span class="n">any</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graficamos</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">l1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">variables_importantes</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span> <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Regularización Lasso&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">coeficientes</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;coeficientes&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Log(lambda)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_78_0.png" src="../../_images/Regularizacion_78_0.png" />
</div>
</div>
<p>Una de las formas de obtener un <span class="math notranslate nohighlight">\(\lambda\)</span> optimo es utiliznado la técnica de <strong>Cross-Validation</strong>.</p>
<p>Esta técnica consiste en partir en k partes el dataset de entrenamiento. El modelo se entrena con k-1 conjuntos y se evalua con el que fue dejado fuera. Este proceso se realiza k veces (folds) y el resultado final es el promedio de todos los entrenamientos.</p>
<p>En este caso ajustaremos 20 veces el modelo Lasso utilizando la función <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LassoCV.html?highlight=lassocv#sklearn.linear_model.LassoCV">LassoCV</a> y graficaremos la evolución del Error Cuadrático Medio para los distintos valores de <span class="math notranslate nohighlight">\(\lambda\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importamos Lasso CV</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ajustamos el modelo mediante Cross-Validation</span>
<span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">lasso</span> <span class="o">=</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">t_lasso_cv</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graficamos</span>

<span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">1e-4</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">lasso</span><span class="o">.</span><span class="n">alphas_</span> <span class="o">+</span> <span class="n">EPSILON</span><span class="p">,</span> <span class="n">lasso</span><span class="o">.</span><span class="n">mse_path_</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">l1</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lasso</span><span class="o">.</span><span class="n">alphas_</span> <span class="o">+</span> <span class="n">EPSILON</span><span class="p">,</span> <span class="n">lasso</span><span class="o">.</span><span class="n">mse_path_</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Promedio entre folds&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">lasso</span><span class="o">.</span><span class="n">alpha_</span> <span class="o">+</span> <span class="n">EPSILON</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;lambda: CV estimado&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\lambda$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Error Cuadratico Medio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Error cuadratico medio en cada fold: coordinate descent &#39;</span>
          <span class="s1">&#39;(train time: </span><span class="si">%.2f</span><span class="s1">s)&#39;</span> <span class="o">%</span> <span class="n">t_lasso_cv</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_82_0.png" src="../../_images/Regularizacion_82_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;El lambda final obtenido mediante CV es: </span><span class="si">{</span><span class="n">lasso</span><span class="o">.</span><span class="n">alpha_</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>El lambda final obtenido mediante CV es: 0.008701498775874552
</pre></div>
</div>
</div>
</div>
<p>Visualizamos los nuevos coeficientes luego de la regularización</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">coeficientes_finales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span><span class="n">lasso</span><span class="o">.</span><span class="n">coef_</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">coeficientes_finales</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span><span class="s1">&#39;coeficiente&#39;</span><span class="p">]</span>
<span class="n">coeficientes_finales</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>coeficiente</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>age</td>
      <td>0.243134</td>
    </tr>
    <tr>
      <th>1</th>
      <td>g</td>
      <td>-0.102507</td>
    </tr>
    <tr>
      <th>2</th>
      <td>gs</td>
      <td>0.108016</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mp_per_g</td>
      <td>-0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>fg_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>fga_per_g</td>
      <td>0.0980427</td>
    </tr>
    <tr>
      <th>6</th>
      <td>fg_pct</td>
      <td>-0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>fg3_per_g</td>
      <td>0.0589395</td>
    </tr>
    <tr>
      <th>8</th>
      <td>fg3a_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>fg3_pct</td>
      <td>-0.00496124</td>
    </tr>
    <tr>
      <th>10</th>
      <td>fg2_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>fg2a_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>fg2_pct</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>efg_pct</td>
      <td>-0.0446762</td>
    </tr>
    <tr>
      <th>14</th>
      <td>ft_per_g</td>
      <td>0.0092704</td>
    </tr>
    <tr>
      <th>15</th>
      <td>fta_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ft_pct</td>
      <td>-0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>orb_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>drb_per_g</td>
      <td>0.118527</td>
    </tr>
    <tr>
      <th>19</th>
      <td>trb_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ast_per_g</td>
      <td>0.117986</td>
    </tr>
    <tr>
      <th>21</th>
      <td>stl_per_g</td>
      <td>0.134783</td>
    </tr>
    <tr>
      <th>22</th>
      <td>blk_per_g</td>
      <td>0.0322813</td>
    </tr>
    <tr>
      <th>23</th>
      <td>tov_per_g</td>
      <td>-0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>pf_per_g</td>
      <td>-0.0882417</td>
    </tr>
    <tr>
      <th>25</th>
      <td>pts_per_g</td>
      <td>0.281782</td>
    </tr>
    <tr>
      <th>26</th>
      <td>position_SG</td>
      <td>-0</td>
    </tr>
    <tr>
      <th>27</th>
      <td>position_PF</td>
      <td>0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>position_SF</td>
      <td>0.111806</td>
    </tr>
    <tr>
      <th>29</th>
      <td>position_C</td>
      <td>0.125095</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;El modelo final cuenta con : </span><span class="si">{</span><span class="n">coeficientes_finales</span><span class="p">[</span><span class="n">coeficientes_finales</span><span class="p">[</span><span class="s1">&#39;coeficiente&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39; features&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>El modelo final cuenta con : 16  features
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="ridge">
<h3>3.3 Ridge<a class="headerlink" href="#ridge" title="Permalink to this headline">¶</a></h3>
<p>Es una técnica de regularización que utiliza una penalización cuadrática:</p>
<p><span class="math notranslate nohighlight">\(\hat{\beta_L}= arg min_\beta\sum_{i=1}^{n}(y_i-\beta_0-\sum_{j=p}^{n}\beta_jx_{ji})^{2}+\lambda\sum_{j=p}^{n}\beta_j^{2}\)</span></p>
<p>Pensandolo en términos de <em>ElasticNet</em> estaríamos en el caso de <span class="math notranslate nohighlight">\(\alpha\)</span>=0. Para hacer este ajuste utilizarmos la función <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.Ridge.html?highlight=ridge#sklearn.linear_model.Ridge">Ridge</a>. Vamos a replicar lo que ya realizamos con Lasso</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Importamos el modelo</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ajustamos el modelo para distintos valores de lambda</span>
<span class="n">n_alphas</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_alphas</span><span class="p">)</span>

<span class="n">coefs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">alphas</span><span class="p">:</span>
    <span class="n">ridge</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ridge</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ridge</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graficamos</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">l1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alphas</span><span class="p">,</span> <span class="n">coefs</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span> <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Regularización Ridge&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;coeficientes&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Log(lambda)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_90_0.png" src="../../_images/Regularizacion_90_0.png" />
</div>
</div>
<p>Vamos a utilizar la función <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.RidgeCV.html?highlight=ridgecv#sklearn.linear_model.RidgeCV">RidgeCV</a> de la librería <em>sklearn</em> para mediante Cross-Validation obtener el <span class="math notranslate nohighlight">\(\lambda\)</span> óptimo</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Importamos el modelo</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">RidgeCV</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ajustamos el modelo para 100 valores distintos de lambda</span>
<span class="n">n_alphas</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="n">n_alphas</span><span class="p">)</span>
<span class="n">ridge</span> <span class="o">=</span> <span class="n">RidgeCV</span><span class="p">(</span><span class="n">alphas</span><span class="o">=</span><span class="n">alphas</span><span class="p">,</span> <span class="n">store_cv_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Si queremos almacenar la evolución del ECM en RidgeCV debemos pasar el parámetro <em>store_cv_values=True</em>. Haciendo esto no podemos controlar el <em>k</em> del cv. Para poder visualizar mejor vamos a seleccionar 20 particiones aleatorias del total que realizo RidgCV</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#La funcion RidgeCV no permite controlar la cantidad de k seleccionamos 20 al azar </span>
<span class="n">number_of_rows</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">cv_values_</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">random_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">number_of_rows</span><span class="p">,</span> 
                                  <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> 
                                  <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">row</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">cv_values_</span><span class="p">[</span><span class="n">random_indices</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Graficamos</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">ridge</span><span class="o">.</span><span class="n">alphas</span> <span class="o">+</span> <span class="n">EPSILON</span><span class="p">,</span> <span class="n">row</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">l1</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ridge</span><span class="o">.</span><span class="n">alphas</span> <span class="o">+</span> <span class="n">EPSILON</span><span class="p">,</span><span class="n">row</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Promedio entre folds&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">ridge</span><span class="o">.</span><span class="n">alpha_</span> <span class="o">+</span> <span class="n">EPSILON</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;lambda: CV estimado&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\lambda$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Error Cuadratico Medio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Error cuadratico medio en cada fold: coordinate descent &#39;</span>
          <span class="s1">&#39;(train time: </span><span class="si">%.2f</span><span class="s1">s)&#39;</span> <span class="o">%</span> <span class="n">t_lasso_cv</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_96_0.png" src="../../_images/Regularizacion_96_0.png" />
</div>
</div>
<p>Seleccion del Lambda optimo</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;El lambda final obtenido mediante CV es: </span><span class="si">{</span><span class="n">ridge</span><span class="o">.</span><span class="n">alpha_</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>El lambda final obtenido mediante CV es: 70.54802310718645
</pre></div>
</div>
</div>
</div>
<p>Visualizamos los nuevos coeficientes luego de la regularización</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">coeficientes_finales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span><span class="n">ridge</span><span class="o">.</span><span class="n">coef_</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">coeficientes_finales</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span><span class="s1">&#39;coeficiente&#39;</span><span class="p">]</span>
<span class="n">coeficientes_finales</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>coeficiente</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>age</td>
      <td>0.203966</td>
    </tr>
    <tr>
      <th>1</th>
      <td>g</td>
      <td>-0.0739022</td>
    </tr>
    <tr>
      <th>2</th>
      <td>gs</td>
      <td>0.086728</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mp_per_g</td>
      <td>0.00371914</td>
    </tr>
    <tr>
      <th>4</th>
      <td>fg_per_g</td>
      <td>0.0643391</td>
    </tr>
    <tr>
      <th>5</th>
      <td>fga_per_g</td>
      <td>0.0654461</td>
    </tr>
    <tr>
      <th>6</th>
      <td>fg_pct</td>
      <td>-0.0280607</td>
    </tr>
    <tr>
      <th>7</th>
      <td>fg3_per_g</td>
      <td>0.0733165</td>
    </tr>
    <tr>
      <th>8</th>
      <td>fg3a_per_g</td>
      <td>0.0530423</td>
    </tr>
    <tr>
      <th>9</th>
      <td>fg3_pct</td>
      <td>-0.009418</td>
    </tr>
    <tr>
      <th>10</th>
      <td>fg2_per_g</td>
      <td>0.0406062</td>
    </tr>
    <tr>
      <th>11</th>
      <td>fg2a_per_g</td>
      <td>0.0484491</td>
    </tr>
    <tr>
      <th>12</th>
      <td>fg2_pct</td>
      <td>0.00095816</td>
    </tr>
    <tr>
      <th>13</th>
      <td>efg_pct</td>
      <td>-0.0207924</td>
    </tr>
    <tr>
      <th>14</th>
      <td>ft_per_g</td>
      <td>0.0483165</td>
    </tr>
    <tr>
      <th>15</th>
      <td>fta_per_g</td>
      <td>0.0364211</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ft_pct</td>
      <td>-0.00721181</td>
    </tr>
    <tr>
      <th>17</th>
      <td>orb_per_g</td>
      <td>0.00106785</td>
    </tr>
    <tr>
      <th>18</th>
      <td>drb_per_g</td>
      <td>0.0662272</td>
    </tr>
    <tr>
      <th>19</th>
      <td>trb_per_g</td>
      <td>0.0486539</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ast_per_g</td>
      <td>0.0965189</td>
    </tr>
    <tr>
      <th>21</th>
      <td>stl_per_g</td>
      <td>0.106267</td>
    </tr>
    <tr>
      <th>22</th>
      <td>blk_per_g</td>
      <td>0.0295367</td>
    </tr>
    <tr>
      <th>23</th>
      <td>tov_per_g</td>
      <td>0.012983</td>
    </tr>
    <tr>
      <th>24</th>
      <td>pf_per_g</td>
      <td>-0.0583935</td>
    </tr>
    <tr>
      <th>25</th>
      <td>pts_per_g</td>
      <td>0.0653002</td>
    </tr>
    <tr>
      <th>26</th>
      <td>position_SG</td>
      <td>-0.0270673</td>
    </tr>
    <tr>
      <th>27</th>
      <td>position_PF</td>
      <td>-0.00724201</td>
    </tr>
    <tr>
      <th>28</th>
      <td>position_SF</td>
      <td>0.0550699</td>
    </tr>
    <tr>
      <th>29</th>
      <td>position_C</td>
      <td>0.0484961</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="elastic-net">
<h3>3.4 Elastic Net<a class="headerlink" href="#elastic-net" title="Permalink to this headline">¶</a></h3>
<p>El modelo de Elastic Net incopora los dos tipos de penalización: Lasso (Norma L1) y Ridge (Norma L2). Define un compromiso entre las penalidades de lasso y ridge. El parámetro <span class="math notranslate nohighlight">\(\alpha\)</span> regula la importancia de cada penalización, cuanto más cerca de cero será más importante la penalización del tipo Ridge y más cerca de 1, la del tipo Lasso.</p>
<p><em>ECM</em> + <span class="math notranslate nohighlight">\(\lambda\)</span> [ <span class="math notranslate nohighlight">\(\alpha\)</span> <span class="math notranslate nohighlight">\(\Sigma_{j}\)</span>|<span class="math notranslate nohighlight">\(\beta_{j}\)</span>| + (1-<span class="math notranslate nohighlight">\(\alpha\)</span>) <span class="math notranslate nohighlight">\(\Sigma_{j}\)</span><span class="math notranslate nohighlight">\(\beta_{j}^{2}\)</span>]</p>
<p>En este caso aplicaremos un modelo con un <span class="math notranslate nohighlight">\(\alpha\)</span>=0.5. Para poder visualizar la evolución de las variables en función de <span class="math notranslate nohighlight">\(\lambda\)</span> vamos a utilizar la funcion <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.enet_path.html?highlight=enet_path#sklearn.linear_model.enet_path">enet_path</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Importamos la funcion enet_path</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">enet_path</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ajsutamos el modelo</span>
<span class="n">eps</span> <span class="o">=</span> <span class="mf">5e-3</span>
<span class="n">alphas_enet</span><span class="p">,</span> <span class="n">coefs_enet</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">enet_path</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span> <span class="n">l1_ratio</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Definimos todos los colores que vamos a utilizar para poder graficar</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">colors</span> <span class="k">as</span> <span class="n">mcolors</span>
<span class="n">colors</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">mcolors</span><span class="o">.</span><span class="n">BASE_COLORS</span><span class="p">,</span> <span class="o">**</span><span class="n">mcolors</span><span class="o">.</span><span class="n">CSS4_COLORS</span><span class="p">)</span>

<span class="c1"># Sort colors by hue, saturation, value and name.</span>
<span class="n">by_hsv</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">((</span><span class="nb">tuple</span><span class="p">(</span><span class="n">mcolors</span><span class="o">.</span><span class="n">rgb_to_hsv</span><span class="p">(</span><span class="n">mcolors</span><span class="o">.</span><span class="n">to_rgba</span><span class="p">(</span><span class="n">color</span><span class="p">)[:</span><span class="mi">3</span><span class="p">])),</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
<span class="n">sorted_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">hsv</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">by_hsv</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">sorted_names</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Graficamos</span>
<span class="n">eps</span> <span class="o">=</span> <span class="mf">5e-3</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">cycle</span><span class="p">(</span><span class="n">sorted_names</span><span class="p">[:</span><span class="mi">30</span><span class="p">])</span>

<span class="n">neg_log_alphas_enet</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">alphas_enet</span><span class="p">)</span>
<span class="k">for</span>  <span class="n">coef_e</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">coefs_enet</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">neg_log_alphas_enet</span><span class="p">,</span> <span class="n">coef_e</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;-Log(alpha)&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;coefficients&#39;</span><span class="p">,</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Elastic-Net Paths&#39;</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_105_0.png" src="../../_images/Regularizacion_105_0.png" />
</div>
</div>
<p>Para la obtención del <span class="math notranslate nohighlight">\(\lambda\)</span> óptimo vamos a utilizar nuevamente la estrategia de <strong>Cross-Validation</strong>. Para eso utilizaremos la función <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.ElasticNetCV.html?highlight=elasticnetcv#sklearn.linear_model.ElasticNetCV">ElasticNetCV</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Importamos el modelo</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">ElasticNetCV</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ajustamos el modelo</span>
<span class="n">enet</span> <span class="o">=</span> <span class="n">ElasticNetCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Graficamos</span>
<span class="n">EPSILON</span> <span class="o">=</span> <span class="mf">1e-4</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">semilogx</span><span class="p">(</span><span class="n">enet</span><span class="o">.</span><span class="n">alphas_</span> <span class="o">+</span> <span class="n">EPSILON</span><span class="p">,</span> <span class="n">enet</span><span class="o">.</span><span class="n">mse_path_</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">l1</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">enet</span><span class="o">.</span><span class="n">alphas_</span> <span class="o">+</span> <span class="n">EPSILON</span><span class="p">,</span> <span class="n">enet</span><span class="o">.</span><span class="n">mse_path_</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Promedio entre folds&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">enet</span><span class="o">.</span><span class="n">alpha_</span> <span class="o">+</span> <span class="n">EPSILON</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s1">&#39;lambda: CV estimado&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\lambda$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Error Cuadratico Medio&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Error cuadratico medio en cada fold: coordinate descent &#39;</span>
          <span class="s1">&#39;(train time: </span><span class="si">%.2f</span><span class="s1">s)&#39;</span> <span class="o">%</span> <span class="n">t_lasso_cv</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">10</span> <span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/Regularizacion_109_0.png" src="../../_images/Regularizacion_109_0.png" />
</div>
</div>
<p>Obtenemos el lambda óptimo</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;El lambda final obtenido mediante CV es: </span><span class="si">{</span><span class="n">enet</span><span class="o">.</span><span class="n">alpha_</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>El lambda final obtenido mediante CV es: 0.01866066383946646
</pre></div>
</div>
</div>
</div>
<p>Visualizamos los nuevos coeficientes luego de la regularización</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">coeficientes_finales</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span><span class="n">enet</span><span class="o">.</span><span class="n">coef_</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">coeficientes_finales</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span><span class="s1">&#39;coeficiente&#39;</span><span class="p">]</span>
<span class="n">coeficientes_finales</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>coeficiente</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>age</td>
      <td>0.241194</td>
    </tr>
    <tr>
      <th>1</th>
      <td>g</td>
      <td>-0.09991</td>
    </tr>
    <tr>
      <th>2</th>
      <td>gs</td>
      <td>0.106392</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mp_per_g</td>
      <td>-0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>fg_per_g</td>
      <td>0.0866818</td>
    </tr>
    <tr>
      <th>5</th>
      <td>fga_per_g</td>
      <td>0.12103</td>
    </tr>
    <tr>
      <th>6</th>
      <td>fg_pct</td>
      <td>-0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>fg3_per_g</td>
      <td>0.0732458</td>
    </tr>
    <tr>
      <th>8</th>
      <td>fg3a_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>fg3_pct</td>
      <td>-0.00578629</td>
    </tr>
    <tr>
      <th>10</th>
      <td>fg2_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>fg2a_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>fg2_pct</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>efg_pct</td>
      <td>-0.0384094</td>
    </tr>
    <tr>
      <th>14</th>
      <td>ft_per_g</td>
      <td>0.049938</td>
    </tr>
    <tr>
      <th>15</th>
      <td>fta_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ft_pct</td>
      <td>-0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>orb_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>drb_per_g</td>
      <td>0.119097</td>
    </tr>
    <tr>
      <th>19</th>
      <td>trb_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ast_per_g</td>
      <td>0.114829</td>
    </tr>
    <tr>
      <th>21</th>
      <td>stl_per_g</td>
      <td>0.130406</td>
    </tr>
    <tr>
      <th>22</th>
      <td>blk_per_g</td>
      <td>0.0313705</td>
    </tr>
    <tr>
      <th>23</th>
      <td>tov_per_g</td>
      <td>-0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>pf_per_g</td>
      <td>-0.0813748</td>
    </tr>
    <tr>
      <th>25</th>
      <td>pts_per_g</td>
      <td>0.124704</td>
    </tr>
    <tr>
      <th>26</th>
      <td>position_SG</td>
      <td>-0</td>
    </tr>
    <tr>
      <th>27</th>
      <td>position_PF</td>
      <td>0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>position_SF</td>
      <td>0.096695</td>
    </tr>
    <tr>
      <th>29</th>
      <td>position_C</td>
      <td>0.100336</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;El modelo final cuenta con : </span><span class="si">{</span><span class="n">coeficientes_finales</span><span class="p">[</span><span class="n">coeficientes_finales</span><span class="p">[</span><span class="s1">&#39;coeficiente&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39; features&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>El modelo final cuenta con : 17  features
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="comparacion-de-modelos">
<h3>3.5 Comparación de Modelos<a class="headerlink" href="#comparacion-de-modelos" title="Permalink to this headline">¶</a></h3>
<p>Para comparar los distintos modelos lo que vamos a hacer es realizar predicciones mediante la método <em>.predict()</em> y evaluarlas con la función <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.mean_squared_error.html?highlight=mean_squared_error#sklearn.metrics.mean_squared_error">mean_squared_error</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#importamos la metrica</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computamos el ECM tomando como modelo al promedio de los salarios</span>
<span class="n">promedio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">mse_promedio</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">promedio</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Importamos el modelo de regresion lineal</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="c1">#Ajustamos el modelo</span>
<span class="n">model_scaled_lineal</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">model_scaled_lineal</span> <span class="o">=</span> <span class="n">model_scaled_lineal</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1">#Obtenemoos las predicciones y el ECM del modelo de regresion lineal</span>
<span class="n">y_pred_lineal</span> <span class="o">=</span> <span class="n">model_scaled_lineal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">mse_lineal</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred_lineal</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Obtenemos el ECM de la regresion Lasso</span>

<span class="n">y_pred_lasso</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">mse_lasso</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred_lasso</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Obtenemos el ECM de la regresion Ridge</span>

<span class="n">y_pred_ridge</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">mse_ridge</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred_ridge</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Obtenemos el ECM de ElasticNet</span>

<span class="n">y_pred_enet</span> <span class="o">=</span> <span class="n">enet</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">mse_enet</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">y_pred_enet</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ordenamos los datos y los acomodamos en un dataframe</span>
<span class="n">modelo</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;promedio&#39;</span><span class="p">,</span> <span class="s1">&#39;lineal&#39;</span><span class="p">,</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span><span class="s1">&#39;enet&#39;</span><span class="p">]</span>
<span class="n">metrica</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;ecm&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">mse_promedio</span><span class="p">,</span> <span class="n">mse_lineal</span><span class="p">,</span> <span class="n">mse_lasso</span><span class="p">,</span> <span class="n">mse_ridge</span><span class="p">,</span> <span class="n">mse_enet</span><span class="p">]</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;modelo&#39;</span><span class="p">,</span> <span class="s1">&#39;metrica&#39;</span><span class="p">,</span> <span class="s1">&#39;valor&#39;</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">modelo</span><span class="p">,</span> <span class="n">metrica</span><span class="p">,</span> <span class="n">error</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>modelo</th>
      <th>metrica</th>
      <th>valor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>promedio</td>
      <td>ecm</td>
      <td>0.919395409837134</td>
    </tr>
    <tr>
      <th>1</th>
      <td>lineal</td>
      <td>ecm</td>
      <td>0.3215583780799656</td>
    </tr>
    <tr>
      <th>2</th>
      <td>lasso</td>
      <td>ecm</td>
      <td>0.3469133209921145</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ridge</td>
      <td>ecm</td>
      <td>0.35615683252822733</td>
    </tr>
    <tr>
      <th>4</th>
      <td>enet</td>
      <td>ecm</td>
      <td>0.3481330201481655</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Ahora vamos a evaluar los modelos en el conjunto de Test</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computamos el ECM tomando como modelo al promedio de los salarios</span>
<span class="n">promedio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">mse_promedio</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">promedio</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Obtenemoos las predicciones y el ECM del modelo de regresion lineal</span>
<span class="n">y_pred_lineal</span> <span class="o">=</span> <span class="n">model_scaled_lineal</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mse_lineal</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_lineal</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Obtenemos el ECM de la regresion Lasso</span>
<span class="n">y_pred_lasso</span> <span class="o">=</span> <span class="n">lasso</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mse_lasso</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_lasso</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Obtenemos el ECM de la regresion Ridge</span>
<span class="n">y_pred_ridge</span> <span class="o">=</span> <span class="n">ridge</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mse_ridge</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_ridge</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Obtenemos el ECM de ElasticNet</span>
<span class="n">y_pred_enet</span> <span class="o">=</span> <span class="n">enet</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mse_enet</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_enet</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ordenamos los datos y los acomodamos en un dataframe</span>
<span class="n">y_pred_enet</span> <span class="o">=</span> <span class="n">enet</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mse_enet</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_enet</span><span class="p">)</span>

<span class="n">modelo</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;promedio&#39;</span><span class="p">,</span> <span class="s1">&#39;lineal&#39;</span><span class="p">,</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span><span class="s1">&#39;ridge&#39;</span><span class="p">,</span><span class="s1">&#39;enet&#39;</span><span class="p">]</span>
<span class="n">metrica</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;ecm&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">mse_promedio</span><span class="p">,</span> <span class="n">mse_lineal</span><span class="p">,</span> <span class="n">mse_lasso</span><span class="p">,</span> <span class="n">mse_ridge</span><span class="p">,</span> <span class="n">mse_enet</span><span class="p">]</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;modelo&#39;</span><span class="p">,</span> <span class="s1">&#39;metrica&#39;</span><span class="p">,</span> <span class="s1">&#39;valor&#39;</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">modelo</span><span class="p">,</span> <span class="n">metrica</span><span class="p">,</span> <span class="n">error</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>modelo</th>
      <th>metrica</th>
      <th>valor</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>promedio</td>
      <td>ecm</td>
      <td>1.1694399867471887</td>
    </tr>
    <tr>
      <th>1</th>
      <td>lineal</td>
      <td>ecm</td>
      <td>0.423775018032688</td>
    </tr>
    <tr>
      <th>2</th>
      <td>lasso</td>
      <td>ecm</td>
      <td>0.409996333475713</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ridge</td>
      <td>ecm</td>
      <td>0.407361527720383</td>
    </tr>
    <tr>
      <th>4</th>
      <td>enet</td>
      <td>ecm</td>
      <td>0.4087681203860019</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="optimizacion-de-hiperparametros">
<h2>4. Optimización de Hiperparámetros<a class="headerlink" href="#optimizacion-de-hiperparametros" title="Permalink to this headline">¶</a></h2>
<p>Los <strong>hiperparametros</strong> no se obtienen mediante el proceso de ajuste, sino que son definición propia del modelo por parte de quien lo esta llevando adelante. La elección de los mismos va a tener una injerencia significativa en el desempeño del modelo ya que por ejemplo pueden ayudar a prevenir el <em>sobreajuste</em> o <em>overfitting</em></p>
<p>En el caso particular de los modelos que estuvimos viendo en esta sección los hiperparámetros serán:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\lambda\)</span>: cuantifica la magnitud de la penalización o regularización a aplicar</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha\)</span>: balancea el tipo de penalidad que vamos a aplicar. Actua como un puente entre <em>Ridge</em> (<span class="math notranslate nohighlight">\(\alpha\)</span>=0) y <em>Lasso</em> (<span class="math notranslate nohighlight">\(\alpha\)</span>=1)</p></li>
</ul>
<div class="section" id="busqueda-de-grilla-o-grid-search">
<h3>4.1 Búsqueda de Grilla o Grid-search<a class="headerlink" href="#busqueda-de-grilla-o-grid-search" title="Permalink to this headline">¶</a></h3>
<p>Tal como indica su nombre la Búsqueda de Grilla se lleva adelante generando una matriz con los distintos valores de los parámetros que deseamos evaluar. Esto implica que la cantidad de iteraciones vendrá dada por todas las posibles combinaciones de los valores de los parámetros que indicamos en la grilla.</p>
<p>En nuestro caso vamos a evaluar esta estrategia sobre el modelo <em>Elastic Net</em>. Para eso vamos a utilizar la función <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html#sklearn.model_selection.GridSearchCV">GridSearchCV</a> de la librería <em>sklearn</em>.
Para conformar la grilla a evaluar debemos generar un diccionario cuyas ‘keys’ van a ser los nombres de los parámetros y una lista de los valores para cada uno de ellos</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importamos el modelo</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span>  <span class="n">ElasticNet</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Definimos la grilla</span>
<span class="n">parametros</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:[</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
               <span class="s1">&#39;l1_ratio&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mi">1</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definimos el modelo</span>
<span class="n">enet</span> <span class="o">=</span> <span class="n">ElasticNet</span><span class="p">()</span> 

<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">enet</span><span class="p">,</span> <span class="n">param_grid</span> <span class="o">=</span> <span class="n">parametros</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ajustamos el modelo</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="n">tiempo_grid</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tiempo de ejecucion </span><span class="si">%s</span><span class="s2"> segundos ---</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tiempo_grid</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mejor combinación de parámetros </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Definición del Modelo </span><span class="si">%s</span><span class="s1"> &#39;</span><span class="o">%</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tiempo de ejecucion 3.659669876098633 segundos ---

Mejor combinación de parámetros {&#39;alpha&#39;: 0.1, &#39;l1_ratio&#39;: 0} 

Definición del Modelo ElasticNet(alpha=0.1, copy_X=True, fit_intercept=True, l1_ratio=0,
           max_iter=1000, normalize=False, positive=False, precompute=False,
           random_state=None, selection=&#39;cyclic&#39;, tol=0.0001, warm_start=False) 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Obtenemos la combinacion total de parametros</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">it</span>

<span class="n">diccionario_parametros</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">parametros</span><span class="p">)</span>
<span class="n">combinaciones</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">parametros</span><span class="p">[</span><span class="n">Name</span><span class="p">]</span> <span class="k">for</span> <span class="n">Name</span> <span class="ow">in</span> <span class="n">diccionario_parametros</span><span class="p">))</span>
<span class="n">combinacioes_realizadas</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">combinaciones</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;lambda&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">])</span>
<span class="n">combinacioes_realizadas</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lambda</th>
      <th>alpha</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.001</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.001</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.001</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.001</td>
      <td>0.75</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.001</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.010</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.010</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.010</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.010</td>
      <td>0.75</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.010</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.100</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0.100</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0.100</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0.100</td>
      <td>0.75</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0.100</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>15</th>
      <td>1.000</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>16</th>
      <td>1.000</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1.000</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1.000</td>
      <td>0.75</td>
    </tr>
    <tr>
      <th>19</th>
      <td>1.000</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>20</th>
      <td>10.000</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>21</th>
      <td>10.000</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>22</th>
      <td>10.000</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>23</th>
      <td>10.000</td>
      <td>0.75</td>
    </tr>
    <tr>
      <th>24</th>
      <td>10.000</td>
      <td>1.00</td>
    </tr>
    <tr>
      <th>25</th>
      <td>100.000</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>26</th>
      <td>100.000</td>
      <td>0.25</td>
    </tr>
    <tr>
      <th>27</th>
      <td>100.000</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>28</th>
      <td>100.000</td>
      <td>0.75</td>
    </tr>
    <tr>
      <th>29</th>
      <td>100.000</td>
      <td>1.00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Cantidad de combinaciones evaluadas </span><span class="si">%s</span><span class="s1"> &#39;</span><span class="o">%</span> <span class="n">combinacioes_realizadas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Cantidad de combinaciones evaluadas 30 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Mostramos los coeficientes fianles</span>
<span class="n">coeficientes_finales_grid</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">coef_</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">coeficientes_finales_grid</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span><span class="s1">&#39;coeficiente&#39;</span><span class="p">]</span>
<span class="n">coeficientes_finales_grid</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>coeficiente</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>age</td>
      <td>0.229535</td>
    </tr>
    <tr>
      <th>1</th>
      <td>g</td>
      <td>-0.0957555</td>
    </tr>
    <tr>
      <th>2</th>
      <td>gs</td>
      <td>0.10859</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mp_per_g</td>
      <td>-0.0322668</td>
    </tr>
    <tr>
      <th>4</th>
      <td>fg_per_g</td>
      <td>0.0735276</td>
    </tr>
    <tr>
      <th>5</th>
      <td>fga_per_g</td>
      <td>0.0738744</td>
    </tr>
    <tr>
      <th>6</th>
      <td>fg_pct</td>
      <td>-0.0351427</td>
    </tr>
    <tr>
      <th>7</th>
      <td>fg3_per_g</td>
      <td>0.0962384</td>
    </tr>
    <tr>
      <th>8</th>
      <td>fg3a_per_g</td>
      <td>0.0485389</td>
    </tr>
    <tr>
      <th>9</th>
      <td>fg3_pct</td>
      <td>-0.0117662</td>
    </tr>
    <tr>
      <th>10</th>
      <td>fg2_per_g</td>
      <td>0.0368981</td>
    </tr>
    <tr>
      <th>11</th>
      <td>fg2a_per_g</td>
      <td>0.0547083</td>
    </tr>
    <tr>
      <th>12</th>
      <td>fg2_pct</td>
      <td>0.0112073</td>
    </tr>
    <tr>
      <th>13</th>
      <td>efg_pct</td>
      <td>-0.0256393</td>
    </tr>
    <tr>
      <th>14</th>
      <td>ft_per_g</td>
      <td>0.0477241</td>
    </tr>
    <tr>
      <th>15</th>
      <td>fta_per_g</td>
      <td>0.0280811</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ft_pct</td>
      <td>-0.00789827</td>
    </tr>
    <tr>
      <th>17</th>
      <td>orb_per_g</td>
      <td>0.00325983</td>
    </tr>
    <tr>
      <th>18</th>
      <td>drb_per_g</td>
      <td>0.0708904</td>
    </tr>
    <tr>
      <th>19</th>
      <td>trb_per_g</td>
      <td>0.050947</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ast_per_g</td>
      <td>0.122156</td>
    </tr>
    <tr>
      <th>21</th>
      <td>stl_per_g</td>
      <td>0.131671</td>
    </tr>
    <tr>
      <th>22</th>
      <td>blk_per_g</td>
      <td>0.0384627</td>
    </tr>
    <tr>
      <th>23</th>
      <td>tov_per_g</td>
      <td>-0.0149141</td>
    </tr>
    <tr>
      <th>24</th>
      <td>pf_per_g</td>
      <td>-0.0827611</td>
    </tr>
    <tr>
      <th>25</th>
      <td>pts_per_g</td>
      <td>0.0731261</td>
    </tr>
    <tr>
      <th>26</th>
      <td>position_SG</td>
      <td>-0.0250485</td>
    </tr>
    <tr>
      <th>27</th>
      <td>position_PF</td>
      <td>0.00601508</td>
    </tr>
    <tr>
      <th>28</th>
      <td>position_SF</td>
      <td>0.0957966</td>
    </tr>
    <tr>
      <th>29</th>
      <td>position_C</td>
      <td>0.0952546</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;El modelo final cuenta con : </span><span class="si">{</span><span class="n">coeficientes_finales_grid</span><span class="p">[</span><span class="n">coeficientes_finales_grid</span><span class="p">[</span><span class="s1">&#39;coeficiente&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39; features&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>El modelo final cuenta con : 30  features
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="busqueda-aleatoria-o-random-search">
<h3>4.2 Búsqueda aleatoria o Random Search<a class="headerlink" href="#busqueda-aleatoria-o-random-search" title="Permalink to this headline">¶</a></h3>
<p>Es una estrategia de búsqueda que realiza combinaciones aleatorias de los parámetros a partir de una definición de la distribución de los mismos por parte del usuario. A diferencia de la Búsqueda de Grilla, la Búsqueda aleatoria requiere que el usuario establezca la cantidad de combinaciones que se van a realizar.</p>
<p>Vamos a utilizar la función <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html">RandomizedSearchCV</a> tambien de sklearn. Al igual que en el caso de la Búsqueda de Grilla, debemos generar un diccionario con las distribuciones de los parámetros a evaluar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Importamos el modelo y algunas funciones auxiliares</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">RandomizedSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.utils.fixes</span> <span class="kn">import</span> <span class="n">loguniform</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stats</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definimos los parametros</span>
<span class="n">parametros</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;l1_ratio&#39;</span><span class="p">:</span> <span class="n">stats</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
              <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="n">loguniform</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e0</span><span class="p">)}</span>
<span class="n">n_iteraciones</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">semilla</span> <span class="o">=</span> <span class="mi">2021</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ajustamos el modelo</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>


<span class="n">enet_random</span> <span class="o">=</span> <span class="n">ElasticNet</span><span class="p">()</span>
<span class="n">random_search</span> <span class="o">=</span> <span class="n">RandomizedSearchCV</span><span class="p">(</span><span class="n">estimator</span> <span class="o">=</span> <span class="n">enet_random</span><span class="p">,</span> <span class="n">n_iter</span> <span class="o">=</span> <span class="n">n_iteraciones</span><span class="p">,</span> <span class="n">param_distributions</span> <span class="o">=</span> <span class="n">parametros</span><span class="p">,</span>
                                   <span class="n">cv</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span><span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="n">semilla</span> <span class="p">)</span>
<span class="n">random_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">tiempo_random</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tiempo de ejecucion </span><span class="si">%s</span><span class="s2"> segundos ---</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">tiempo_random</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mejor combinación de parámetros </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">random_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Definición del Modelo </span><span class="si">%s</span><span class="s1"> </span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">%</span> <span class="n">random_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Combinaciones Evaluadas </span><span class="si">%s</span><span class="s1"> &#39;</span><span class="o">%</span> <span class="n">n_iteraciones</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Tiempo de ejecucion 1.8526663780212402 segundos ---

Mejor combinación de parámetros {&#39;alpha&#39;: 0.08489851771634822, &#39;l1_ratio&#39;: 0.06905627482497878} 

Definición del Modelo ElasticNet(alpha=0.08489851771634822, copy_X=True, fit_intercept=True,
           l1_ratio=0.06905627482497878, max_iter=1000, normalize=False,
           positive=False, precompute=False, random_state=None,
           selection=&#39;cyclic&#39;, tol=0.0001, warm_start=False) 

Combinaciones Evaluadas 15 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Visualizamos los coeficientes</span>
<span class="n">coeficientes_finales_random</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span><span class="n">random_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">coef_</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">coeficientes_finales_random</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature&#39;</span><span class="p">,</span><span class="s1">&#39;coeficiente&#39;</span><span class="p">]</span>
<span class="n">coeficientes_finales_random</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feature</th>
      <th>coeficiente</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>age</td>
      <td>0.22965</td>
    </tr>
    <tr>
      <th>1</th>
      <td>g</td>
      <td>-0.0923156</td>
    </tr>
    <tr>
      <th>2</th>
      <td>gs</td>
      <td>0.100706</td>
    </tr>
    <tr>
      <th>3</th>
      <td>mp_per_g</td>
      <td>-0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>fg_per_g</td>
      <td>0.0750549</td>
    </tr>
    <tr>
      <th>5</th>
      <td>fga_per_g</td>
      <td>0.0771243</td>
    </tr>
    <tr>
      <th>6</th>
      <td>fg_pct</td>
      <td>-0.0192146</td>
    </tr>
    <tr>
      <th>7</th>
      <td>fg3_per_g</td>
      <td>0.082323</td>
    </tr>
    <tr>
      <th>8</th>
      <td>fg3a_per_g</td>
      <td>0.0341439</td>
    </tr>
    <tr>
      <th>9</th>
      <td>fg3_pct</td>
      <td>-0.00839912</td>
    </tr>
    <tr>
      <th>10</th>
      <td>fg2_per_g</td>
      <td>0.0242524</td>
    </tr>
    <tr>
      <th>11</th>
      <td>fg2a_per_g</td>
      <td>0.043298</td>
    </tr>
    <tr>
      <th>12</th>
      <td>fg2_pct</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>efg_pct</td>
      <td>-0.0231833</td>
    </tr>
    <tr>
      <th>14</th>
      <td>ft_per_g</td>
      <td>0.0480324</td>
    </tr>
    <tr>
      <th>15</th>
      <td>fta_per_g</td>
      <td>0.0251325</td>
    </tr>
    <tr>
      <th>16</th>
      <td>ft_pct</td>
      <td>-0.00317777</td>
    </tr>
    <tr>
      <th>17</th>
      <td>orb_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>drb_per_g</td>
      <td>0.0773544</td>
    </tr>
    <tr>
      <th>19</th>
      <td>trb_per_g</td>
      <td>0.0420583</td>
    </tr>
    <tr>
      <th>20</th>
      <td>ast_per_g</td>
      <td>0.110477</td>
    </tr>
    <tr>
      <th>21</th>
      <td>stl_per_g</td>
      <td>0.122284</td>
    </tr>
    <tr>
      <th>22</th>
      <td>blk_per_g</td>
      <td>0.0314199</td>
    </tr>
    <tr>
      <th>23</th>
      <td>tov_per_g</td>
      <td>0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>pf_per_g</td>
      <td>-0.0740552</td>
    </tr>
    <tr>
      <th>25</th>
      <td>pts_per_g</td>
      <td>0.0772824</td>
    </tr>
    <tr>
      <th>26</th>
      <td>position_SG</td>
      <td>-0.0114224</td>
    </tr>
    <tr>
      <th>27</th>
      <td>position_PF</td>
      <td>0</td>
    </tr>
    <tr>
      <th>28</th>
      <td>position_SF</td>
      <td>0.0769059</td>
    </tr>
    <tr>
      <th>29</th>
      <td>position_C</td>
      <td>0.0730377</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;El modelo final cuenta con : </span><span class="si">{</span><span class="n">coeficientes_finales_random</span><span class="p">[</span><span class="n">coeficientes_finales_random</span><span class="p">[</span><span class="s1">&#39;coeficiente&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39; features&#39;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>El modelo final cuenta con : 25  features
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="comparacion-de-optimizadores">
<h3>4.3 Comparación de Optimizadores<a class="headerlink" href="#comparacion-de-optimizadores" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Computamos el ECM del Grid Search</span>
<span class="n">y_pred_grid</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mse_grid</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_grid</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Computamos el ECM del Random Search</span>
<span class="n">y_pred_random</span> <span class="o">=</span> <span class="n">random_search</span><span class="o">.</span><span class="n">best_estimator_</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">mse_random</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_random</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Organizamos la informacion en un dataframe</span>
<span class="n">estrategia</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;GridSearch&#39;</span><span class="p">,</span> <span class="s1">&#39;RandomSearch&#39;</span><span class="p">]</span>
<span class="n">tiempo</span> <span class="o">=</span> <span class="p">[</span><span class="n">tiempo_grid</span><span class="p">,</span> <span class="n">tiempo_random</span><span class="p">]</span>
<span class="n">metrica</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="s1">&#39;ecm&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">error</span> <span class="o">=</span> <span class="p">[</span><span class="n">mse_grid</span><span class="p">,</span> <span class="n">mse_random</span><span class="p">]</span>
<span class="n">iteraciones</span> <span class="o">=</span> <span class="p">[</span><span class="n">combinacioes_realizadas</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_iteraciones</span> <span class="p">]</span>
<span class="n">folds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
<span class="n">n_variables</span> <span class="o">=</span> <span class="p">[</span> <span class="n">coeficientes_finales_grid</span><span class="p">[</span><span class="n">coeficientes_finales_grid</span><span class="p">[</span><span class="s1">&#39;coeficiente&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeficientes_finales_random</span><span class="p">[</span><span class="n">coeficientes_finales_random</span><span class="p">[</span><span class="s1">&#39;coeficiente&#39;</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;estregia&#39;</span><span class="p">,</span><span class="s1">&#39;tiempo&#39;</span><span class="p">,</span> <span class="s1">&#39;metrica&#39;</span><span class="p">,</span> <span class="s1">&#39;valor&#39;</span><span class="p">,</span> <span class="s1">&#39;combinaciones&#39;</span><span class="p">,</span> <span class="s1">&#39;folds&#39;</span><span class="p">,</span> <span class="s1">&#39;n_variables&#39;</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">estrategia</span><span class="p">,</span> <span class="n">tiempo</span><span class="p">,</span> <span class="n">metrica</span><span class="p">,</span> <span class="n">error</span><span class="p">,</span> <span class="n">iteraciones</span><span class="p">,</span> <span class="n">folds</span><span class="p">,</span> <span class="n">n_variables</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>estregia</th>
      <th>tiempo</th>
      <th>metrica</th>
      <th>valor</th>
      <th>combinaciones</th>
      <th>folds</th>
      <th>n_variables</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>GridSearch</td>
      <td>3.659669876098633</td>
      <td>ecm</td>
      <td>0.4002855442992554</td>
      <td>30</td>
      <td>20</td>
      <td>30</td>
    </tr>
    <tr>
      <th>1</th>
      <td>RandomSearch</td>
      <td>1.8526663780212402</td>
      <td>ecm</td>
      <td>0.40661539371450983</td>
      <td>15</td>
      <td>20</td>
      <td>25</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="feature-engineering">
<h2>5. Feature Engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this headline">¶</a></h2>
<p>Vamos a cargar nuevamente el conjutno de datos para poder operar las distintas transformaciones que deseemos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nba</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;https://datasets-humai.s3.amazonaws.com/datasets/nba_salarios_2021.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="imputacion-de-datos-faltantes">
<h3>5.1 Imputación de datos faltantes<a class="headerlink" href="#imputacion-de-datos-faltantes" title="Permalink to this headline">¶</a></h3>
<p>La imputación de datos faltantes puede hacerse mediante distitnas estrategias:</p>
<p><strong>Variables Numéricas</strong></p>
<ul class="simple">
<li><p>Media: completar los nulos con la media de la columna</p></li>
<li><p>Mediana: completar los nulos con la mediana de la columna</p></li>
<li><p>Media Condicionada: los nulos se completan con la media condicionada respecto a alguna otra columna.</p></li>
</ul>
<p><strong>Variables Numéricas o Categóricas</strong></p>
<ul class="simple">
<li><p>Valor más frecuente: se completa con el valor que más veces se repite en la columna</p></li>
<li><p>Valor Constante: se completa con algun valor que se desee</p></li>
</ul>
<p>Para poder hacerlo vamos a utilizar la función <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.impute.SimpleImputer.html#sklearn.impute.SimpleImputer">SimpleImputer</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Observamos cuantos datos faltantes hay en cada columna</span>
<span class="n">nba</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>player        0
salary        2
position      0
age           0
team_id       0
g             0
gs            0
mp_per_g      0
fg_per_g      0
fga_per_g     0
fg_pct        0
fg3_per_g     0
fg3a_per_g    0
fg3_pct       0
fg2_per_g     0
fg2a_per_g    0
fg2_pct       0
efg_pct       0
ft_per_g      0
fta_per_g     0
ft_pct        0
orb_per_g     0
drb_per_g     0
trb_per_g     0
ast_per_g     0
stl_per_g     0
blk_per_g     0
tov_per_g     0
pf_per_g      0
pts_per_g     0
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Generamos un par de nulos en la posicion para poder imputar categoricas</span>
<span class="n">nba</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nba</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">nba</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualizamos los casos con faltantes</span>
<span class="n">nba</span><span class="p">[</span><span class="n">nba</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>player</th>
      <th>salary</th>
      <th>position</th>
      <th>age</th>
      <th>team_id</th>
      <th>g</th>
      <th>gs</th>
      <th>mp_per_g</th>
      <th>fg_per_g</th>
      <th>fga_per_g</th>
      <th>fg_pct</th>
      <th>fg3_per_g</th>
      <th>fg3a_per_g</th>
      <th>fg3_pct</th>
      <th>fg2_per_g</th>
      <th>fg2a_per_g</th>
      <th>fg2_pct</th>
      <th>efg_pct</th>
      <th>ft_per_g</th>
      <th>fta_per_g</th>
      <th>ft_pct</th>
      <th>orb_per_g</th>
      <th>drb_per_g</th>
      <th>trb_per_g</th>
      <th>ast_per_g</th>
      <th>stl_per_g</th>
      <th>blk_per_g</th>
      <th>tov_per_g</th>
      <th>pf_per_g</th>
      <th>pts_per_g</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>401</th>
      <td>Frank Jackson</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>21</td>
      <td>NOP</td>
      <td>59</td>
      <td>2</td>
      <td>13.5</td>
      <td>2.3</td>
      <td>5.6</td>
      <td>0.405</td>
      <td>0.8</td>
      <td>2.4</td>
      <td>0.326</td>
      <td>1.5</td>
      <td>3.2</td>
      <td>0.465</td>
      <td>0.476</td>
      <td>0.9</td>
      <td>1.3</td>
      <td>0.747</td>
      <td>0.4</td>
      <td>1.0</td>
      <td>1.4</td>
      <td>1.0</td>
      <td>0.3</td>
      <td>0.1</td>
      <td>0.8</td>
      <td>1.3</td>
      <td>6.3</td>
    </tr>
    <tr>
      <th>402</th>
      <td>Chimezie Metu</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>22</td>
      <td>SAS</td>
      <td>18</td>
      <td>0</td>
      <td>5.8</td>
      <td>1.3</td>
      <td>2.3</td>
      <td>0.571</td>
      <td>0.0</td>
      <td>0.1</td>
      <td>0.000</td>
      <td>1.3</td>
      <td>2.2</td>
      <td>0.600</td>
      <td>0.571</td>
      <td>0.6</td>
      <td>0.7</td>
      <td>0.769</td>
      <td>0.7</td>
      <td>1.2</td>
      <td>1.8</td>
      <td>0.6</td>
      <td>0.2</td>
      <td>0.3</td>
      <td>0.6</td>
      <td>0.4</td>
      <td>3.2</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importamos la funcion</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Separamos las variables categoricas y nulas con faltantes para poder tener una mejor visualizacion</span>
<span class="n">numericas</span> <span class="o">=</span> <span class="n">nba</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]]</span>
<span class="n">categoricas</span> <span class="o">=</span> <span class="n">nba</span><span class="p">[[</span><span class="s1">&#39;position&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p>Procedemos a hacerlo con las variables numéricas</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imputamos con la media</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
<span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">numericas</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span>
<span class="n">numericas</span><span class="p">[</span><span class="s1">&#39;media&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">numericas</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imputamos con la mediana</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)</span>
<span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">numericas</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span>
<span class="n">numericas</span><span class="p">[</span><span class="s1">&#39;mediana&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">numericas</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imputamos con un valor constante</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">fill_value</span> <span class="o">=</span> <span class="mi">99999</span><span class="p">)</span>
<span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">numericas</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span>
<span class="n">numericas</span><span class="p">[</span><span class="s1">&#39;constante&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">numericas</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imputamos con el valor mas frecuente</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;most_frequent&#39;</span><span class="p">)</span>
<span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">numericas</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span>
<span class="n">numericas</span><span class="p">[</span><span class="s1">&#39;mas_frecuente&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">numericas</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualizamos el resultado de las distintas estraegias</span>
<span class="n">numericas</span><span class="p">[</span><span class="n">numericas</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salary</th>
      <th>media</th>
      <th>mediana</th>
      <th>constante</th>
      <th>mas_frecuente</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>401</th>
      <td>NaN</td>
      <td>8.863481e+06</td>
      <td>4938272.0</td>
      <td>99999.0</td>
      <td>1517981.0</td>
    </tr>
    <tr>
      <th>402</th>
      <td>NaN</td>
      <td>8.863481e+06</td>
      <td>4938272.0</td>
      <td>99999.0</td>
      <td>1517981.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Ahora lo hacemos con las variables categoricas</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imputamos con un valor constante</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">fill_value</span> <span class="o">=</span> <span class="s1">&#39;S/D&#39;</span><span class="p">)</span>
<span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">categoricas</span><span class="p">[[</span><span class="s1">&#39;position&#39;</span><span class="p">]])</span>
<span class="n">categoricas</span><span class="p">[</span><span class="s1">&#39;constante&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">categoricas</span><span class="p">[[</span><span class="s1">&#39;position&#39;</span><span class="p">]])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imputamos con el valor mas frecuente</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;most_frequent&#39;</span><span class="p">)</span>
<span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">categoricas</span><span class="p">[[</span><span class="s1">&#39;position&#39;</span><span class="p">]])</span>
<span class="n">categoricas</span><span class="p">[</span><span class="s1">&#39;mas_frecuente&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">categoricas</span><span class="p">[[</span><span class="s1">&#39;position&#39;</span><span class="p">]])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">categoricas</span><span class="p">[</span><span class="n">categoricas</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>position</th>
      <th>constante</th>
      <th>mas_frecuente</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>401</th>
      <td>NaN</td>
      <td>S/D</td>
      <td>SG</td>
    </tr>
    <tr>
      <th>402</th>
      <td>NaN</td>
      <td>S/D</td>
      <td>SG</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="binning">
<h3>5.2 Binning<a class="headerlink" href="#binning" title="Permalink to this headline">¶</a></h3>
<p>Es una estrategia que se utiliza para agrupar en bins  los registros en función de cierto criterio. Con esto se resigna variabilidad en las variables pero se gana robustez en el modelo general.</p>
<p><strong>Numéricas</strong></p>
<p>Vamos a armar bins a partir del valor de los salarios para eso vamos a usar la funcion <em>qcut</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generamos 10 bins</span>
<span class="n">nba</span><span class="p">[</span><span class="s1">&#39;salario_bins&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">nba</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">],</span> <span class="n">q</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">nba</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">,</span><span class="s1">&#39;salario_bins&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salary</th>
      <th>salario_bins</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>43006362.0</td>
      <td>(26131111.0, 43006362.0]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>41358814.0</td>
      <td>(26131111.0, 43006362.0]</td>
    </tr>
    <tr>
      <th>2</th>
      <td>41358814.0</td>
      <td>(26131111.0, 43006362.0]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40824000.0</td>
      <td>(26131111.0, 43006362.0]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>39219565.0</td>
      <td>(26131111.0, 43006362.0]</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>398</th>
      <td>898310.0</td>
      <td>(339999.999, 1620564.0]</td>
    </tr>
    <tr>
      <th>399</th>
      <td>744684.0</td>
      <td>(339999.999, 1620564.0]</td>
    </tr>
    <tr>
      <th>400</th>
      <td>340000.0</td>
      <td>(339999.999, 1620564.0]</td>
    </tr>
    <tr>
      <th>401</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>402</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>403 rows × 2 columns</p>
</div></div></div>
</div>
<p><strong>Categoricas</strong></p>
<p>Vamos a reemplazar todas aquellas posiciones multiples. Para eso vamos a utilizar la funcion <em>np.where</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Observamos lso valores que puede tomar la variable position</span>
<span class="n">nba</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SG       92
C        82
PF       78
SF       73
PG       64
SF-PF     3
PF-C      3
SF-SG     2
SF-C      1
SG-PG     1
PG-SG     1
PF-SF     1
Name: position, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Reemplazamos los valores que representan multiples posiciones</span>
<span class="n">nba</span><span class="p">[</span><span class="s1">&#39;posicion_agrup&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">nba</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;SG&#39;</span><span class="p">,</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="s1">&#39;PF&#39;</span><span class="p">,</span><span class="s1">&#39;SF&#39;</span><span class="p">,</span><span class="s1">&#39;PG&#39;</span><span class="p">]),</span><span class="n">nba</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">],</span> <span class="s1">&#39;Otro&#39;</span><span class="p">)</span>
<span class="n">nba</span><span class="p">[</span><span class="s1">&#39;posicion_agrup&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SG      92
C       82
PF      78
SF      73
PG      64
Otro    14
Name: posicion_agrup, dtype: int64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="one-hot-encoding">
<h3>5.3 One-hot Encoding<a class="headerlink" href="#one-hot-encoding" title="Permalink to this headline">¶</a></h3>
<p>Dada una variable categórica con N filas y M categorías, mediante el One-hot-encoding la variable se va a expresar como una matriz de N filas por M columnas (NxM). En donde cada columna representa una de las categorías de la variable original y están codificadas con los valores 1 y 0.</p>
<p>Esto lo podemos llevar adelante con la función <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.OneHotEncoder.html?highlight=onehotenco#sklearn.preprocessing.OneHotEncoder">OneHotEncoder</a> o la función <a class="reference external" href="https://pandas.pydata.org/docs/reference/api/pandas.get_dummies.html">get_dummies</a> de pandas</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#realizamos el One-hot Encoding con get_dummies</span>
<span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">nba</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>C</th>
      <th>PF</th>
      <th>PF-C</th>
      <th>PF-SF</th>
      <th>PG</th>
      <th>PG-SG</th>
      <th>SF</th>
      <th>SF-C</th>
      <th>SF-PF</th>
      <th>SF-SG</th>
      <th>SG</th>
      <th>SG-PG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>398</th>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>399</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>400</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>401</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>402</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>403 rows × 12 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Importamos OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">OneHotEncoder</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Imputamos los datos faltantes porque no debe contener nans</span>
<span class="n">imputer</span> <span class="o">=</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">missing_values</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;most_frequent&#39;</span><span class="p">)</span>
<span class="n">imputer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nba</span><span class="p">[[</span><span class="s1">&#39;position&#39;</span><span class="p">]])</span>
<span class="n">nba</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">imputer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">nba</span><span class="p">[[</span><span class="s1">&#39;position&#39;</span><span class="p">]])</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ajustamos el encoder </span>
<span class="n">enc</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">enc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nba</span><span class="p">[[</span><span class="s1">&#39;position&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>OneHotEncoder(categories=&#39;auto&#39;, drop=None, dtype=&lt;class &#39;numpy.float64&#39;&gt;,
              handle_unknown=&#39;ignore&#39;, sparse=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Generamos las dummies</span>
<span class="n">dummies</span> <span class="o">=</span> <span class="n">enc</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">nba</span><span class="p">[[</span><span class="s1">&#39;position&#39;</span><span class="p">]])</span>
<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dummies</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>10</th>
      <th>11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>398</th>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>399</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>400</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>401</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>402</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>403 rows × 12 columns</p>
</div></div></div>
</div>
</div>
<div class="section" id="agrupacion">
<h3>5.4 Agrupación<a class="headerlink" href="#agrupacion" title="Permalink to this headline">¶</a></h3>
<p>Mediante la agrupación se puede  generar nuevas variables resumiendo de la información de distintas observaciones y agrupandolas según algún criterio que surte a partir de otra/otras variables. La función que utilizaremos es <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.groupby.html">groupby</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculamos la media de las variables salary y fga_per_g por posicion</span>
<span class="n">nba</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_per_g&#39;</span> <span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salary</th>
      <th>fga_per_g</th>
    </tr>
    <tr>
      <th>position</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>C</th>
      <td>8.332535e+06</td>
      <td>6.759756</td>
    </tr>
    <tr>
      <th>PF</th>
      <td>8.547970e+06</td>
      <td>7.726923</td>
    </tr>
    <tr>
      <th>PF-C</th>
      <td>1.025007e+07</td>
      <td>8.066667</td>
    </tr>
    <tr>
      <th>PF-SF</th>
      <td>3.623000e+06</td>
      <td>4.600000</td>
    </tr>
    <tr>
      <th>PG</th>
      <td>1.241442e+07</td>
      <td>10.750000</td>
    </tr>
    <tr>
      <th>PG-SG</th>
      <td>2.028594e+06</td>
      <td>6.400000</td>
    </tr>
    <tr>
      <th>SF</th>
      <td>8.638060e+06</td>
      <td>7.639726</td>
    </tr>
    <tr>
      <th>SF-C</th>
      <td>6.167887e+06</td>
      <td>2.800000</td>
    </tr>
    <tr>
      <th>SF-PF</th>
      <td>8.695466e+06</td>
      <td>8.333333</td>
    </tr>
    <tr>
      <th>SF-SG</th>
      <td>4.650000e+06</td>
      <td>8.400000</td>
    </tr>
    <tr>
      <th>SG</th>
      <td>7.596279e+06</td>
      <td>8.528723</td>
    </tr>
    <tr>
      <th>SG-PG</th>
      <td>2.331593e+06</td>
      <td>10.500000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculamos la media de las variables salary y fga_per_g por posicion y equipo</span>
<span class="n">nba</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;position&#39;</span><span class="p">,</span><span class="s1">&#39;team_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">&#39;salary&#39;</span><span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;fga_per_g&#39;</span> <span class="p">:</span><span class="s1">&#39;mean&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>salary</th>
      <th>fga_per_g</th>
    </tr>
    <tr>
      <th>position</th>
      <th>team_id</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">C</th>
      <th>ATL</th>
      <td>1.627563e+06</td>
      <td>3.400</td>
    </tr>
    <tr>
      <th>BOS</th>
      <td>3.663619e+06</td>
      <td>4.300</td>
    </tr>
    <tr>
      <th>BRK</th>
      <td>4.385176e+06</td>
      <td>4.075</td>
    </tr>
    <tr>
      <th>CHI</th>
      <td>4.200180e+06</td>
      <td>4.700</td>
    </tr>
    <tr>
      <th>CHO</th>
      <td>6.491489e+06</td>
      <td>6.000</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="4" valign="top">SG</th>
      <th>TOR</th>
      <td>8.787978e+06</td>
      <td>8.900</td>
    </tr>
    <tr>
      <th>TOT</th>
      <td>9.818643e+06</td>
      <td>7.960</td>
    </tr>
    <tr>
      <th>UTA</th>
      <td>2.767750e+06</td>
      <td>10.800</td>
    </tr>
    <tr>
      <th>WAS</th>
      <td>1.531732e+07</td>
      <td>13.700</td>
    </tr>
    <tr>
      <th>SG-PG</th>
      <th>TOT</th>
      <td>2.331593e+06</td>
      <td>10.500</td>
    </tr>
  </tbody>
</table>
<p>156 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculamos la media, el minimo, maximo y la sumo de la variable salary</span>
<span class="n">nba</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;position&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">min_salary</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;salary&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span> 
                            <span class="n">max_salary</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;salary&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">),</span>
                            <span class="n">media_salary</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;salary&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">),</span>
                            <span class="n">suma_salary</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;salary&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>min_salary</th>
      <th>max_salary</th>
      <th>media_salary</th>
      <th>suma_salary</th>
    </tr>
    <tr>
      <th>position</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>C</th>
      <td>1445697.0</td>
      <td>29542010.0</td>
      <td>8.332535e+06</td>
      <td>683267884.0</td>
    </tr>
    <tr>
      <th>PF</th>
      <td>898310.0</td>
      <td>36595996.0</td>
      <td>8.547970e+06</td>
      <td>666741644.0</td>
    </tr>
    <tr>
      <th>PF-C</th>
      <td>2564753.0</td>
      <td>16047100.0</td>
      <td>1.025007e+07</td>
      <td>30750198.0</td>
    </tr>
    <tr>
      <th>PF-SF</th>
      <td>3623000.0</td>
      <td>3623000.0</td>
      <td>3.623000e+06</td>
      <td>3623000.0</td>
    </tr>
    <tr>
      <th>PG</th>
      <td>1000000.0</td>
      <td>43006362.0</td>
      <td>1.241442e+07</td>
      <td>794522696.0</td>
    </tr>
    <tr>
      <th>PG-SG</th>
      <td>2028594.0</td>
      <td>2028594.0</td>
      <td>2.028594e+06</td>
      <td>2028594.0</td>
    </tr>
    <tr>
      <th>SF</th>
      <td>1445697.0</td>
      <td>35450412.0</td>
      <td>8.638060e+06</td>
      <td>630578366.0</td>
    </tr>
    <tr>
      <th>SF-C</th>
      <td>6167887.0</td>
      <td>6167887.0</td>
      <td>6.167887e+06</td>
      <td>6167887.0</td>
    </tr>
    <tr>
      <th>SF-PF</th>
      <td>1944677.0</td>
      <td>14883721.0</td>
      <td>8.695466e+06</td>
      <td>26086398.0</td>
    </tr>
    <tr>
      <th>SF-SG</th>
      <td>3300000.0</td>
      <td>6000000.0</td>
      <td>4.650000e+06</td>
      <td>9300000.0</td>
    </tr>
    <tr>
      <th>SG</th>
      <td>340000.0</td>
      <td>40824000.0</td>
      <td>7.596279e+06</td>
      <td>698857646.0</td>
    </tr>
    <tr>
      <th>SG-PG</th>
      <td>2331593.0</td>
      <td>2331593.0</td>
      <td>2.331593e+06</td>
      <td>2331593.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="escalado-de-datos">
<h3>5.5 Escalado de Datos<a class="headerlink" href="#escalado-de-datos" title="Permalink to this headline">¶</a></h3>
<p>Hay algoritmos que son sonsibles a la magnitud de los datos, por eso se vuelve relevalante escalarlos y llevarlos todos al mismo rango. Para existo se utilizan principalmente dos strategias</p>
<ul class="simple">
<li><p>Normalización: <span class="math notranslate nohighlight">\(X_{norm} = \frac{X-X_{min}}{X_{max}-X_{min}}\)</span></p></li>
<li><p>Estandarización: <span class="math notranslate nohighlight">\(X_{std} = \frac{X-\mu}{\sigma}\)</span></p></li>
</ul>
<p>Donde <span class="math notranslate nohighlight">\(\mu\)</span> y <span class="math notranslate nohighlight">\(\sigma\)</span> son la media y el desvío standard de la distribución de la variable a estandarizar.</p>
<p>Para la estandarizacion vamos a utilizar <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.StandardScaler.html?highlight=standard%20scaler#sklearn.preprocessing.StandardScaler">StandardScaler</a> y para la normalización <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.preprocessing.MinMaxScaler.html?highlight=minmax#sklearn.preprocessing.MinMaxScaler">MinMaxScaler</a> ambas de <em>sklearn</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#generamos un dataframe que sea solo la columna salario</span>
<span class="n">salario</span> <span class="o">=</span> <span class="n">nba</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Vamos a normalizar la variable salario</span>
<span class="c1"># Importamos la función</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ajustamos el escalado</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">salario</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MinMaxScaler(copy=True, feature_range=(0, 1))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Realizamos la normalizacion</span>
<span class="n">salario</span><span class="p">[</span><span class="s1">&#39;norm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">salario</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">salario</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salary</th>
      <th>norm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>43006362.0</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>41358814.0</td>
      <td>0.961385</td>
    </tr>
    <tr>
      <th>2</th>
      <td>41358814.0</td>
      <td>0.961385</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40824000.0</td>
      <td>0.948851</td>
    </tr>
    <tr>
      <th>4</th>
      <td>39219565.0</td>
      <td>0.911246</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>398</th>
      <td>898310.0</td>
      <td>0.013085</td>
    </tr>
    <tr>
      <th>399</th>
      <td>744684.0</td>
      <td>0.009485</td>
    </tr>
    <tr>
      <th>400</th>
      <td>340000.0</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>401</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>402</th>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>403 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Vamos a estandarizar la variable salario</span>
<span class="c1"># Importamos la función</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ajustamos el escalado</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">scaler</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">salario</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>StandardScaler(copy=True, with_mean=True, with_std=True)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Realizamos la estandarización</span>
<span class="n">salario</span><span class="p">[</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">salario</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#vemos como quedaron las distitnas alternativas</span>
<span class="n">salario</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salary</th>
      <th>norm</th>
      <th>std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>43006362.0</td>
      <td>1.000000</td>
      <td>3.636593</td>
    </tr>
    <tr>
      <th>1</th>
      <td>41358814.0</td>
      <td>0.961385</td>
      <td>3.461111</td>
    </tr>
    <tr>
      <th>2</th>
      <td>41358814.0</td>
      <td>0.961385</td>
      <td>3.461111</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40824000.0</td>
      <td>0.948851</td>
      <td>3.404147</td>
    </tr>
    <tr>
      <th>4</th>
      <td>39219565.0</td>
      <td>0.911246</td>
      <td>3.233257</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>398</th>
      <td>898310.0</td>
      <td>0.013085</td>
      <td>-0.848378</td>
    </tr>
    <tr>
      <th>399</th>
      <td>744684.0</td>
      <td>0.009485</td>
      <td>-0.864741</td>
    </tr>
    <tr>
      <th>400</th>
      <td>340000.0</td>
      <td>0.000000</td>
      <td>-0.907845</td>
    </tr>
    <tr>
      <th>401</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>402</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>403 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Vemos la distribucion</span>
<span class="n">salario</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salary</th>
      <th>norm</th>
      <th>std</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>4.010000e+02</td>
      <td>401.000000</td>
      <td>4.010000e+02</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>8.863481e+06</td>
      <td>0.199771</td>
      <td>2.079246e-16</td>
    </tr>
    <tr>
      <th>std</th>
      <td>9.400429e+06</td>
      <td>0.220324</td>
      <td>1.001249e+00</td>
    </tr>
    <tr>
      <th>min</th>
      <td>3.400000e+05</td>
      <td>0.000000</td>
      <td>-9.078446e-01</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2.090040e+06</td>
      <td>0.041017</td>
      <td>-7.214460e-01</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>4.938272e+06</td>
      <td>0.107773</td>
      <td>-4.180780e-01</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.213834e+07</td>
      <td>0.276526</td>
      <td>3.488091e-01</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.300636e+07</td>
      <td>1.000000</td>
      <td>3.636593e+00</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="pipelines">
<h2>6. Pipelines<a class="headerlink" href="#pipelines" title="Permalink to this headline">¶</a></h2>
<p>Un pipeline es <em>‘Una lista de transformaciones aplicadas de forma secuencial sobre el estimador. Los pasos intermedios deben ser “transforms” es decir, implementan los métodos fit y transform. El estimador final sólo necesita implementar el fit’</em>.</p>
<p>Vamos a usar la función <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.pipeline.Pipeline.html">Pipeline</a> a la cual le debemos pasar una lista de tuplas de procedimientos que queremos realizar.</p>
<p>Trabajaremos con variables numericas para ejemplificar el procedimiento</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Seleccionamos las variables numéricas</span>
<span class="n">nba_numericas</span> <span class="o">=</span> <span class="n">nba</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span><span class="s1">&#39;int64&#39;</span><span class="p">])</span>
<span class="n">nba_numericas</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>salary</th>
      <th>age</th>
      <th>g</th>
      <th>gs</th>
      <th>mp_per_g</th>
      <th>fg_per_g</th>
      <th>fga_per_g</th>
      <th>fg_pct</th>
      <th>fg3_per_g</th>
      <th>fg3a_per_g</th>
      <th>fg3_pct</th>
      <th>fg2_per_g</th>
      <th>fg2a_per_g</th>
      <th>fg2_pct</th>
      <th>efg_pct</th>
      <th>ft_per_g</th>
      <th>fta_per_g</th>
      <th>ft_pct</th>
      <th>orb_per_g</th>
      <th>drb_per_g</th>
      <th>trb_per_g</th>
      <th>ast_per_g</th>
      <th>stl_per_g</th>
      <th>blk_per_g</th>
      <th>tov_per_g</th>
      <th>pf_per_g</th>
      <th>pts_per_g</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>43006362.0</td>
      <td>31</td>
      <td>5</td>
      <td>5</td>
      <td>27.8</td>
      <td>6.6</td>
      <td>16.4</td>
      <td>0.402</td>
      <td>2.4</td>
      <td>9.8</td>
      <td>0.245</td>
      <td>4.2</td>
      <td>6.6</td>
      <td>0.636</td>
      <td>0.476</td>
      <td>5.2</td>
      <td>5.2</td>
      <td>1.000</td>
      <td>0.8</td>
      <td>4.4</td>
      <td>5.2</td>
      <td>6.6</td>
      <td>1.0</td>
      <td>0.4</td>
      <td>3.2</td>
      <td>2.2</td>
      <td>20.8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>41358814.0</td>
      <td>31</td>
      <td>57</td>
      <td>57</td>
      <td>35.9</td>
      <td>10.6</td>
      <td>22.5</td>
      <td>0.472</td>
      <td>1.0</td>
      <td>3.7</td>
      <td>0.258</td>
      <td>9.6</td>
      <td>18.7</td>
      <td>0.514</td>
      <td>0.493</td>
      <td>5.1</td>
      <td>6.7</td>
      <td>0.763</td>
      <td>1.8</td>
      <td>6.2</td>
      <td>7.9</td>
      <td>7.0</td>
      <td>1.6</td>
      <td>0.4</td>
      <td>4.5</td>
      <td>3.5</td>
      <td>27.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>41358814.0</td>
      <td>34</td>
      <td>70</td>
      <td>70</td>
      <td>31.5</td>
      <td>6.2</td>
      <td>12.7</td>
      <td>0.489</td>
      <td>1.6</td>
      <td>4.3</td>
      <td>0.365</td>
      <td>4.6</td>
      <td>8.3</td>
      <td>0.554</td>
      <td>0.552</td>
      <td>3.6</td>
      <td>4.0</td>
      <td>0.907</td>
      <td>0.4</td>
      <td>4.6</td>
      <td>5.0</td>
      <td>6.7</td>
      <td>1.6</td>
      <td>0.2</td>
      <td>2.3</td>
      <td>2.3</td>
      <td>17.6</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40824000.0</td>
      <td>30</td>
      <td>68</td>
      <td>68</td>
      <td>36.5</td>
      <td>9.9</td>
      <td>22.3</td>
      <td>0.444</td>
      <td>4.4</td>
      <td>12.4</td>
      <td>0.355</td>
      <td>5.5</td>
      <td>9.9</td>
      <td>0.556</td>
      <td>0.543</td>
      <td>10.2</td>
      <td>11.8</td>
      <td>0.865</td>
      <td>1.0</td>
      <td>5.5</td>
      <td>6.6</td>
      <td>7.5</td>
      <td>1.8</td>
      <td>0.9</td>
      <td>4.5</td>
      <td>3.3</td>
      <td>34.3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>39219565.0</td>
      <td>35</td>
      <td>67</td>
      <td>67</td>
      <td>34.6</td>
      <td>9.6</td>
      <td>19.4</td>
      <td>0.493</td>
      <td>2.2</td>
      <td>6.3</td>
      <td>0.348</td>
      <td>7.4</td>
      <td>13.1</td>
      <td>0.564</td>
      <td>0.550</td>
      <td>3.9</td>
      <td>5.7</td>
      <td>0.693</td>
      <td>1.0</td>
      <td>6.9</td>
      <td>7.8</td>
      <td>10.2</td>
      <td>1.2</td>
      <td>0.5</td>
      <td>3.9</td>
      <td>1.8</td>
      <td>25.3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Eliminamos los registros que no poseen salario</span>
<span class="n">nba_numericas</span> <span class="o">=</span> <span class="n">nba_numericas</span><span class="p">[</span><span class="n">nba_numericas</span><span class="p">[</span><span class="s1">&#39;salary&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()]</span>
<span class="c1"># Separamos la variable target de las predictoras</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">nba_numericas</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;salary&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">nba_numericas</span><span class="p">[[</span><span class="s1">&#39;salary&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Separamos en train y en test</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">semilla</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definimos el diccionario con los pasos que queremos que tenga el pipeline en este caso StandardScaler y ElasticNet</span>

<span class="n">pasos</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;enet&#39;</span><span class="p">,</span> <span class="n">ElasticNet</span><span class="p">())]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Importamos la funcion Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definimos el objeto que va a contener nuestro pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pasos</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Como vamos a ealphajecutar una busqueda de grilla definimos los parametros a evaluar</span>
<span class="c1">#debemos poner el nombre del estimador seguido de __ y luego el parametro</span>
<span class="n">parametros</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;enet__alpha&#39;</span><span class="p">:[</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
               <span class="s1">&#39;enet__l1_ratio&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mi">1</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instanciamos la búsqueda de grilla pasandole el pipeline que deseamos que ejecute</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">parametros</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span> <span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ajustamos nuestro modelo al conjunto de entramiento</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=20, error_score=nan,
             estimator=Pipeline(memory=None,
                                steps=[(&#39;scaler&#39;,
                                        StandardScaler(copy=True,
                                                       with_mean=True,
                                                       with_std=True)),
                                       (&#39;enet&#39;,
                                        ElasticNet(alpha=1.0, copy_X=True,
                                                   fit_intercept=True,
                                                   l1_ratio=0.5, max_iter=1000,
                                                   normalize=False,
                                                   positive=False,
                                                   precompute=False,
                                                   random_state=None,
                                                   selection=&#39;cyclic&#39;,
                                                   tol=0.0001,
                                                   warm_start=False))],
                                verbose=False),
             iid=&#39;deprecated&#39;, n_jobs=None,
             param_grid={&#39;enet__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100],
                         &#39;enet__l1_ratio&#39;: [0, 0.25, 0.5, 0.75, 1]},
             pre_dispatch=&#39;2*n_jobs&#39;, refit=True, return_train_score=False,
             scoring=&#39;neg_mean_squared_error&#39;, verbose=0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Obtenemos el mejor Score del modelo</span>
<span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;score = </span><span class="si">%3.2f</span><span class="s2">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span><span class="n">y_test</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>score = -48937768521970.49
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Imprimimos los mejores parametros</span>
<span class="nb">print</span><span class="p">(</span> <span class="n">grid</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;enet__alpha&#39;: 1, &#39;enet__l1_ratio&#39;: 0.75}
</pre></div>
</div>
</div>
</div>
<p>Si quisieramos incorporar el imputer en caso de tener registros sin datos los pasos que debieramos pasarles serian los siguientes:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#Agregamos un imputador con una estrategia de media</span>
<span class="n">pasos</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span> <span class="p">(</span><span class="s1">&#39;enet&#39;</span><span class="p">,</span> <span class="n">ElasticNet</span><span class="p">())]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Definimos el objeto que va a contener nuestro pipeline</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">pasos</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Como vamos a ealphajecutar una busqueda de grilla definimos los parametros a evaluar</span>
<span class="c1">#debemos poner el nombre del estimador seguido de __ y luego el parametro</span>
<span class="n">parametros</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;enet__alpha&#39;</span><span class="p">:[</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
               <span class="s1">&#39;enet__l1_ratio&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.75</span><span class="p">,</span><span class="mi">1</span><span class="p">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instanciamos la búsqueda de grilla pasandole el pipeline que deseamos que ejecute</span>

<span class="n">grid</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">parametros</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span> <span class="s1">&#39;neg_mean_squared_error&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ajustamos nuestro modelo al conjunto de entramiento</span>
<span class="n">grid</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV(cv=20, error_score=nan,
             estimator=Pipeline(memory=None,
                                steps=[(&#39;imputer&#39;,
                                        SimpleImputer(add_indicator=False,
                                                      copy=True,
                                                      fill_value=None,
                                                      missing_values=nan,
                                                      strategy=&#39;mean&#39;,
                                                      verbose=0)),
                                       (&#39;scaler&#39;,
                                        StandardScaler(copy=True,
                                                       with_mean=True,
                                                       with_std=True)),
                                       (&#39;enet&#39;,
                                        ElasticNet(alpha=1.0, copy_X=True,
                                                   fit_intercept=True,
                                                   l1_ratio=0.5, max_iter=1000,
                                                   normalize=False,
                                                   positive=False,
                                                   precompute=False,
                                                   random_state=None,
                                                   selection=&#39;cyclic&#39;,
                                                   tol=0.0001,
                                                   warm_start=False))],
                                verbose=False),
             iid=&#39;deprecated&#39;, n_jobs=None,
             param_grid={&#39;enet__alpha&#39;: [0.001, 0.01, 0.1, 1, 10, 100],
                         &#39;enet__l1_ratio&#39;: [0, 0.25, 0.5, 0.75, 1]},
             pre_dispatch=&#39;2*n_jobs&#39;, refit=True, return_train_score=False,
             scoring=&#39;neg_mean_squared_error&#39;, verbose=0)
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./MachineLearning/3_Regularizacion"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../2_RegresionLinealMultiple/RegresionLinealMultiple.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Regresión Lineal Múltiple</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../5_KNNyArbolesDeDecision/KNN_Arboles.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Modelos no paramétricos: K-Nearest Neighbours y Árboles de decisión</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By Matías Grinberg<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>